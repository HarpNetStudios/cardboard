///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	defvar  EDT_Width  1 83 0 // in units of (fontscale Width )
	defvar  EDT_Height 1 23 0 // in units of (fontscale Height)

	defvar  EDT_NewMap_Size  10 10 16
	defsvar EDT_SaveMap_Name "untitled"
]

newgui "editing" [
	guiscale 0.7
	guikeeptab 1
	guinoautotab [
		// Save the frames 'guitabnum' hack:             H                                 V
							   if (= $guitabnum 1) [ guilist [guistrut $EDT_Height 1; guilist [guistrut $EDT_Width 1; EDT_TAB_Editing      ]] ]
		guitab "texture"     ; if (= $guitabnum 2) [ guilist [guistrut $EDT_Height 1; guilist [guistrut $EDT_Width 1; EDT_TAB_Texture      ]] ]
		guitab "entity"      ; if (= $guitabnum 3) [ guilist [guistrut $EDT_Height 1; guilist [guistrut $EDT_Width 1; EDT_TAB_Entities     ]] ]
		guitab "newent"      ; if (= $guitabnum 4) [ guilist [guistrut $EDT_Height 1; guilist [guistrut $EDT_Width 1; EDT_TAB_NewEntity    ]] ]
		guitab "height/blend"; if (= $guitabnum 5) [ guilist [guistrut $EDT_Height 1; guilist [guistrut $EDT_Width 1; EDT_TAB_Height_Blend ]] ]
		guitab "adjustments" ; if (= $guitabnum 6) [ guilist [guistrut $EDT_Height 1; guilist [guistrut $EDT_Width 1; EDT_TAB_Adjustments  ]] ]
		guitab "map"         ; if (= $guitabnum 7) [ guilist [guistrut $EDT_Height 1; guilist [guistrut $EDT_Width 1; EDT_TAB_Map          ]] ]
		guitab "map.cfg"     ; if (= $guitabnum 8) [ guilist [guistrut $EDT_Height 1; guilist [guistrut $EDT_Width 1; EDT_TAB_Cfg          ]] ]
	]
] "editing"


//#############################################################################################################################################
//#############################################################################################################################################
EDT_TAB_Editing = [
	guibutton "toggle edit mode^t^t^f2[RALT]"  [edittoggle]
	guibar //-------------------------------------------------------------------------
	guilist [// H
		guilist [// V
			guistrut 41.5 1
			guitext "select^t^t^t^t^f2[MouseLeft ^f6drag^f2]"
			guitext "extend selection^t^t^f2[MouseRight]"
			guitext "move selection^t^t^f2[MouseRight ^f6drag^f2]"
			guitext "deselect^t^t^t^t^f2[SPACE]"
			guitext "select all ents in box^t^f2[NumPad-ENTER]"
		]
		guilist [// V
			guitext "select corners^t^t^t^f2[MouseMiddle ^f6drag^f2]"
			guitext "reorient selection^t^t^f2[MouseRight]"
			guitext "passthrough^t^t^t^f2[LCTRL ^f6hold^f2]"
			guitext "center view on ent^t^t^f2[, + MouseWheel]"
			guitext "select all matching ents^t^f2[N]"
		]
	]
	guibar //-------------------------------------------------------------------------
	guilist [// H
		guilist [// V
			guistrut 41.5 1
			guitext "push/pull selection^t^t^f2[MouseWheel]"
			guitext "change gridsize^t^t^f2[G + MouseWheel]"
			guitext "flip on selected axis^t^f2[X]"
		]
		guilist [// V
			guitext "push cube face^t^t^f2[F + MouseWheel]"
			guitext "push corner^t^t^t^f2[Q + MouseWheel]"
			guitext "rotate^t^t^t^t^f2[R + MouseWheel]"
		]
	]
	guibar //-------------------------------------------------------------------------
	guilist [// H
		guilist [// V
			guistrut 41.5 1
			guitext "copy^t^t^t^t^t^f2[C]"
			guitext "delete^t^t^t^t^f2[Delete]"
		]
		guilist [// V
			guitext "paste^t^t^t^t^f2[V]"
		]
	]
	guibar //-------------------------------------------------------------------------
	guilist [// H
		guilist [// V
			guistrut 41.5 1
			guitext "undo^t^t^t^t^f2[U] [Z]"
		]
		guilist [// V
			guitext "redo^t^t^t^t^t^f2[I]"
		]
	]
	guilist [// H
		guilist [// V
			guistrut 12 1
			guitext "undo size:"
		]
		guilist [// V
			guistrut 71 1
			guilistslider undomegs [1 2 4 6 8 10 20 30 40 60 80 120 160 200 240 320 400 480 560 640 720 800 880 960 1000]
			guilist [// H
				guitext "^f9(in megabytes)"
				guispring
				guitext "^f9(default 8)"
			]
		]
	]
	guibar //-------------------------------------------------------------------------
	guilist [// H
		guilist [// V
			guistrut 41.5 1
			guibutton "cube material volumes^t^f2/mapmaterials" [mapmaterials]  "menu"
			guistrut 0.5
			guibutton "prefab browser^t^t^f2[Insert]"   [showgui "prefabs"]   "menu"
			guistrut 0.5
			guicheckbox "toggle outline^t^t^t^f2[7]"  outline
		]
		guilist [// V
			guistrut 1.5
			guibutton "mapmodel browser^t^t^f2[F3]"       [showgui "mapmodels"]   "menu"
			guistrut 0.5
			guicheckbox "toggle wireframe" wireframe
		]
	]
]

//#############################################################################################################################################
nodebug [
]

EDT_TAB_Texture = [
	guistrut 0.25
	guilist [// H
		guilist [// V
			guistrut 12 1
		]
		guilist [
			guistrut 28 1
			guifreerow 22 -2 [ guitext "change texture"
					 ]  6 -2 [ guitext "^f2[Y + MouseWheel]"
			]
			guifreerow 22 -2 [ guibutton "texture browser" [showtexgui]
					 ]  6 -2 [ guitext "^f2[F2]"
			]
			guistrut 0.5
			guifreerow 22 -2 [ guitext "texture all faces"
					 ]  6 -2 [ guitext "^f2[6]"
			]
		]
	]
	guistrut 0.5
	guibar //-------------------------------------------------------------------------
	guistrut 0.35
	guifreerow 12 -2 [
			 ] 22 -2 [ guibutton "texture slot manager" [showgui "texslotmanager"]
			 ]  6 -2 [ guitext "^f2[F9]"
			 ]  0 -2 [ guitext "^f2/toggletexman"
	]
	guistrut 0.5
	guibar //-------------------------------------------------------------------------
	guistrut 0.25
	guilist [// H
		guilist [// V
			guistrut 12 1
			guialign 1 [// H
				guitext "parameters: "
			]
		]
		guilist [// V
			guistrut 28 1
			guifreerow 22 -2 [ guitext "offset by 8 on X"
					 ] 20 -2 [ guitext "^f2[1 + MouseWheel]"
					 ]  0 -2 [ guitext "^f~offset by 1^t^f2[+ALT]"
			]
			guifreerow 22 -2 [ guitext "offset by 8 on Y"
					 ] 20 -2 [ guitext "^f2[2 + MouseWheel]"
			]
			guistrut 0.25
			guifreerow 22 -2 [ guitext "rotate-by-90 and/or flip"
					 ] 20 -2 [ guitext "^f2[3 + MouseWheel]"
			]
			guistrut 0.25
			guifreerow 22 -2 [ guitext "scale half/double"
					 ] 20 -2 [ guitext "^f2[4 + MouseWheel]"
					 ]  0 -2 [ guitext "^f~ +- 1/16  ^t^f2[+ALT]"  // 0.0625
			]
			guistrut 1
			guifreerow 22 -2 [ guibutton "color editor" [showgui "vcolor"]
					 ]  6 -2 [ guitext "^f2[F7]"
					 ]  0 -2 [ guitext "^f2/vcolorgui"
			]
			guistrut 0.25
			guifreerow 22 -2 [ guibutton "shaderparam editor" [showgui "vshaderparam"]
					 ]  6 -2 [ guitext "^f2[F8]"
					 ]  0 -2 [ guitext "^f2/vshaderparamgui"
			]
			guistrut 1
			guifreerow 22 -2 [ guibutton "reset all parameters" [vreset]
					 ] 20 -2 [ guitext "^f2/vreset"
			]
		]
	]
]


//#############################################################################################################################################
EDT_TAB_Entities = [
	guilist [// H
		guistrut 12
		guilist [// V
			guistrut 28 1
			guicheckbox "entity selection^t^f2[8]"     myentediting //entediting
			guicheckbox "entity snap-to-grid^t^f2[9]"  entselsnap
		]
		guilist [
			guicheckbox "new entities take yaw from camera  ^f2[0]"  entcamdir
		]
	]
	guistrut 1
	guilist [// H
		guilist [// V
			guistrut 12 1
			guialign 1 [// H
				guitext "entdrop: "
			]
		]
		guilist [
			guistrut 28 1
			guiradio "^f9(2) ^f~at selection"                       entdrop 2
			guiradio "^f9(3) ^f~at selection, to the floor"         entdrop 3
		]
		guilist [
			guiradio "^f9(0) ^f~at current position"                entdrop 0
			guiradio "^f9(1) ^f~at current position, to the floor"  entdrop 1
		]
	]
	guistrut 0.5
	guibar //-------------------------------------------------------------------------
	guistrut 0.35
	guilist [// H
		guilist [// V
			guistrut 12 1
		]
		guilist [
			guistrut 28 1
			guibutton "entity manager ^t^f2[F10]  /toggleentman"    [showgui "entitymanager"]
		]
	]
	guistrut 0.5
	guibar //-------------------------------------------------------------------------
	guistrut 0.25
	guilist [// H
		guilist [// V
			guistrut 12 1
			guialign 1 [// H
				guitext "attributes: "
			]
		]
		guilist [
			guistrut 28 1
			guifreerow  8 -2 [ guitext "attr 1"
					 ] 20 -2 [ guitext "^f2[1 + MouseWheel]"
			]
			guifreerow  8 -2 [ guitext "attr 2"
					 ] 20 -2 [ guitext "^f2[2 + MouseWheel]"
			]
			guifreerow  8 -2 [ guitext "attr 3"
					 ] 20 -2 [ guitext "^f2[3 + MouseWheel]"
					 ] 20 -2 [ guitext "-/+ by 10 ^f2[ALT + 1-5 + MouseWheel]"
			]
			guifreerow  8 -2 [ guitext "attr 4"
					 ] 20 -2 [ guitext "^f2[4 + MouseWheel]"
			]
			guifreerow  8 -2 [ guitext "attr 5"
					 ] 20 -2 [ guitext "^f2[5 + MouseWheel]"
			]
		]
	]
	guistrut 1
	guilist [// H
		guistrut 12
		guilist [// V
			guistrut 28 1
			guibutton "edit selected entity  ^f2[F3]"  showentgui
		]
		guilist [
			guibutton "edit selected entity in console  ^f2[.]"  selentedit
		]
	]
]


//#############################################################################################################################################
nodebug [
	defsvar NewEntString "*"
]

EDT_TAB_NewEntity = [
	cond [>= (strstr $guirolloveraction "showgui") 0][ NewEntString (concat (at $guirollovername 0) "*")
	]    [>= (strstr $guirolloveraction "newent")  0][ NewEntString $guirollovername
	]
	guistrut 0.25
	guititle (concatword "^f2/newent " $NewEntString)
	guistrut 0.75
	guilist [// H
		guilist [// V
			guistrut 12 1
		]
		guilist [// V
			guistrut 22 1
			guibutton "light"             [showgui "newent_light"]
			guibutton "mapmodel  ^f2[F4]" [showgui "mapmodels"]
			guibutton "jumppad"           [newent jumppad] //[showgui "newent_jumppad"]
			guibutton "teleport"          [showgui "newent_teleport"]
			guibutton "checkpoint"        [newent checkpoint] //[showgui "newent_checkpoint"]
		]
		guilist [// V
			guistrut 22 1
			guibutton "playerstart"       [newent playerstart]
			guibutton "playerstart ^f31"  [newent playerstart 1]
			guibutton "playerstart ^f12"  [newent playerstart 2]
			guibutton "^f4ammo"           [newent ammo]
			guibutton "start"             [newent start] //[showgui "newent_start"]
		 ]
		guilist [// V
			guibutton "base"              [newent base]
			guibutton "flag ^f31"         [newent flag 1]
			guibutton "flag ^f12"         [newent flag 2]
			guibutton "^f4health"         [newent health]
			guibutton "finish"            [newent finish] //[showgui "newent_finish"]
		]
	]
	guistrut 0.25
	guialign 0 [
		guibutton "select all pickup entities  ^f2/entfindpickups"   [entfindpickups]
	]
]


//#############################################################################################################################################
EDT_TAB_Height_Blend = [
	guialign 0 [// H
		guilist [// V
			guititle "heightmap"
			guilist [// H
				guilist [// V
					guistrut 38 1
					guitext "toggle heightmap mode^t^t^f2[H]"
					guitext "push/pull heightmap^t^t^f2[MouseWheel]"
				]
				guilist [// V
					guistrut 38 1
					guistrut 1
					guitext "select heightmap brush^t^f2[B + MouseWheel]"
				]
			]
		]
	]
	guistrut 1
	guibar //-------------------------------------------------------------------------
	guialign 0 [// H
		guilist [// V
			guititle "blendmap"
			guilist [// H
				guilist [// V
					guistrut 38 1
					guitext "paint mode:"
					guilist [// H
						guistrut 4
						guilist [// V
							guiradio (concatword "^f9(0)^f~ " (at $Labels_BlendPaintMode 0) "^t^t^f2[NumPad 0]")  blendpaintmode 0
							guiradio (concatword "^f9(2)^f~ " (at $Labels_BlendPaintMode 2) "^t^t^f2[NumPad 1]")  blendpaintmode 2
							guiradio (concatword "^f9(5)^f~ " (at $Labels_BlendPaintMode 5) "^t^t^f2[NumPad 2]")  blendpaintmode 5
						]
					]
					guistrut 1
					guibutton "reveal blendmap^t^f2[NumPad 3]" [clearlightmaps; showblendmap]
				]
				guilist [// V
					guistrut 38 1
					guistrut 1
					guitext "paint^t^t^t^t^f2[MouseLeft]"
					guitext "change brush^t^t^f2[MouseWheel]"
					guitext "rotate brush^t^t^f2[MouseRight]"
					guistrut 1
					guibutton "clear entire blendmap^t^t^f2/clearblendmap"        [clearblendmap]
					guibutton "clear blendmap in selection^t^f2/clearblendmapsel" [clearblendmapsel]
				]
			]
		]
	]
]


//#############################################################################################################################################
EDT_TAB_Adjustments = [
	guialign 0 [// H
		guilist [// V
			guistrut 1  ; guibutton "fog^t^t^t^f2/mapfog"                 [mapfog           ] "menu"
			guistrut 0.5; guibutton "lighting^t^t^f2/maplighting"         [maplighting      ] "menu"
			guistrut 0.5; guibutton "materials^t^t^f2/mapmaterials"       [mapmaterials     ] "menu"
			guistrut 2  ; guibutton "atmo^t^t^f2/mapsky_atmo"             [mapsky_atmo      ] "menu"
			guistrut 0.5; guibutton "cloudbox^t^t^f2/mapsky_cloudbox"     [mapsky_cloudbox  ] "menu"
			guistrut 0.5; guibutton "cloudlayer^t^f2/mapsky_cloudlayer"   [mapsky_cloudlayer] "menu"
			guistrut 0.5; guibutton "skybox^t^t^f2/mapsky_skybox"         [mapsky_skybox    ] "menu"
		]
	]
]


//#############################################################################################################################################
nodebug [
	defsvar WayPointFile ""
]

EDT_TAB_Map = [
	guifreerow 18  1 [ guitext "newmap: "
			 ] 12 -2 [ guitext "scale:"
			 ] 45 -2 [ guislider EDT_NewMap_Size 10 16
	]
	guifreerow 18 -2 [
			 ] 12 -2 [ guitext "size:"
			 ] 45 -2 [ guinameslider EDT_NewMap_Size ["1024" "2048" "4096" "8192" "16384" "32768" "65536"] [10 11 12 13 14 15 16] []
	]
	guistrut 0.25
	guilist [// H
		guistrut 18
		guibutton "start newmap" [newmap $EDT_NewMap_Size]
	]
	guistrut 0.5
	guifreerow 18  1 [ guitext "savemap: "
			 ]  1 -2 [ guistayopen [ guibutton (concatword "save ^"" (? $mapname $mapname "untitled") ".cmr^"") [savemap] ]
	]
	guistrut 0.25
	guifreerow 18  1 [
			 ]  1 -2 [ guitext "save as "
			 ] 24 -2 [ guifield  EDT_SaveMap_Name 22
			 ]  1 -2 [ guistayopen [ guibutton "save" [savemap $EDT_SaveMap_Name] ]
	]
	guistrut 0.5
	guilist [// H
		guistrut 18
		guilist [// V
			guistayopen [
				guibutton "reload map^t^t^f2/reloadmap"         [reloadmap]
				guibutton "reload map config^t^f2/reloadmapcfg" [reloadmapcfg]
			]
		]
	]
	guibar //-------------------------------------------------------------------------
	guilist [// H
		guistrut 18
		guibutton "set map title/author"  [saycommand (concatword "/maptitle " (escape @maptitle))]
	]
	guibar //-------------------------------------------------------------------------
	guifreerow 18 -2 [
			 ] 24 -2 [ guistayopen [ guibutton "^f2/remip" remip ]
			 ]  1 -2 [ guitext "^f9(optimize octree, geometry)"
	]
	guifreerow 18 -2 [
			 ] 24 -2 [ guistayopen [ guibutton "^f2/recalc" recalc ]
			 ]  1 -2 [ guitext "^f9(regenerate: envmaps, minimap, etc)"
	]
	guibar //-------------------------------------------------------------------------
	guifreerow 18  1 [ guitext "resize: "
			 ]  1 -2 [ guistayopen [ guibutton "increase mapsize (double)" mapenlarge ]
	]
	guifreerow 18 -2 [
			 ] 24 -2 [ guistayopen [ guibutton "decrease mapsize (half)" shrinkmap ]
			 ]  1 -2 [ guitext "^f9(shrunk area must be empty)"
	]
	guibar //-------------------------------------------------------------------------
	guilist [// H
		guilist [// V
			guistrut 18 1
			guialign 1 [guitext "waypoints: "]
		]
		guilist [// V
			guistrut 56 1
			WayPointFile (concatword (? $mapname $mapname "untitled") ".wpt")
			guistayopen [ guibutton (concatword (? (findfile (concatword "packages/base/" $WayPointFile)) "" "^f4")  "load ^"" $WayPointFile "^"") [loadwaypoints] ]
			guistayopen [ guibutton (concatword "save ^"" $WayPointFile "^"") [savewaypoints] ]
			guistrut 0.5
			guifreerow 12 -2 [ guicheckbox "show  ^f2[-]" showwaypoints
					 ]  1 -2 [ guicheckbox "drop  ^f2[=]" dropwaypoints
			]
			guistrut 0.5
			guilist [// H
				guilist [guistrut 15 1; guitext "view distance:"]
				guilist [guistrut 45 1; guislider showwaypointsradius]
			]
		]
	]
]


//#############################################################################################################################################
EDT_TAB_Cfg = [
	guitext (mapcfgname)
	guistrut 0.25
	guitexteditor (mapcfgname) -80 20
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  Map Model Browser:
nodebug [
	defvarp mmguiwidth  2 7 12
	defvarp mmguiheight 2 4 12
	defvarp mmguiname   0 1  1

	defvar  MMB_ModelsPerTab 0 0 144
]

newgui "mapmodels" [
	if (|| (! $editing) (! (ingame))) [cleargui 1] [
		guikeeptab 1
		guinoautotab [
			MMB_ModelsPerTab = (* $mmguiwidth $mmguiheight)
			loop iTab (div (+ $nummapmodels (- $MMB_ModelsPerTab 1)) $MMB_ModelsPerTab) [
				if $iTab [guitab (+ $iTab 1)]
				if (= $guitabnum (+ $iTab 1)) [
					loop iY $mmguiheight [
						guilist [
							loop iX $mmguiwidth [
								iMdl = (+ (* $iTab $MMB_ModelsPerTab) (+ (* $iY $mmguiwidth) $iX))
								// guiplayerpreview, "iiisfis"    char *model, char *animspec, char *action, float *scale, int *overlaid, char *title, int *throttle
								guimodelpreview (mapmodelname $iMdl) "mapmodel" [newent mapmodel @iMdl] 3 1 $iMdl 1
							]
						]
					]
					if (!= $mmguiname 0) [
						guistrut 0.2
						guititle (concatword "^f7[^f2" (at $guirolloverpreviewaction 2) "^f7] ^f2" $guirolloverpreviewname)
					]
				]
			]
		]
	]
] "Mapmodels"


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  Prefab Browser:
nodebug [
	defvarp pfguiwidth  2 7 12
	defvarp pfguiheight 2 4 12
	defvarp pfguiname   0 2  3

	defsvar prefabdir "packages/prefab/" [if (!=s $prefabdir "packages/prefab/") [prefabdir "packages/prefab/"; error "variable prefabdir is read-only"]]

	defvar  PFB_NumOfPrefabs  0 0 16384
	defvar  PFB_PrefabsPerTab 0 0 144

	defvar  PFB_DeleteMode 0 0 1
	defsvar PFB_DeleteMe   ""

	PrefabList = "" //  Alias strings can be much longer.
]

newgui "prefabs" [
	if (|| (! $editing) (! (ingame))) [cleargui 1] [
		guikeeptab 1
		guinoautotab [
			PFB_PrefabsPerTab = (* $pfguiwidth $pfguiheight)
			loop iTab (div (+ $PFB_NumOfPrefabs (- $PFB_PrefabsPerTab 1)) $PFB_PrefabsPerTab) [
				if $iTab [guitab (+ $iTab 1)]
				if (= $guitabnum (+ $iTab 1)) [
					loop iY $pfguiheight [
						guilist [// H
							if (>= $pfguiname 2) [
								loop iX $pfguiwidth [
									iPrfb = (+ (* $iTab $PFB_PrefabsPerTab) (+ (* $iY $pfguiwidth) $iX))
									Prefab = (at $PrefabList $iPrfb)
									guiprefabpreview $Prefab 0xFFC040 [pasteprefab @Prefab] 3.0 1 $Prefab 1
								]
							][
								loop iX $pfguiwidth [
									iPrfb = (+ (* $iTab $PFB_PrefabsPerTab) (+ (* $iY $pfguiwidth) $iX))
									Prefab = (at $PrefabList $iPrfb)
									guiprefabpreview $Prefab 0xFFC040 [pasteprefab @Prefab] 3.0 1 "" 1
								]
							]
							//loop iX $pfguiwidth [
							//    iPrfb = (+ (* $iTab $PFB_PrefabsPerTab) (+ (* $iY $pfguiwidth) $iX))
							//    Prefab = (at $PrefabList $iPrfb)
							//    //  guiprefabpreview "sisfisi"    char *prefab, int *color, char *action, float *scale, int *overlaid, char *title, int *throttle
							//    if $PFB_DeleteMode [
							//        guiprefabpreview $Prefab 0xFF2010 [PFB_DeleteMe @Prefab; showgui "prefab_confirmdelete"] 3.0 1 (? (=s @Prefab $guirolloverpreviewname) "DELETE" "") 1
							//    ][
							//        guiprefabpreview $Prefab 0xFFC040 [pasteprefab @Prefab] 3.0 1 $Prefab 1
							//    ]
							//]
						]
					]
					if (|| [= $pfguiname 1][= $pfguiname 3]) [
						guistrut 0.2
						guititle $guirolloverpreviewname
					]
					//guibutton "save prefab" [saveprefab $PFB_SaveName]
					//guicheckbox "delete" PFB_DeleteMode
				]
			]
		]
	]
] "Prefabs" [GenPrefabList]

GenPrefabList = [
	PrefabList = ""
	PFB_NumOfPrefabs 0
	loopfiles File $prefabdir "obr" [
		PrefabList = (concatword $PrefabList (escape $File))
		PFB_NumOfPrefabs (+ $PFB_NumOfPrefabs 1)
	]
	PrefabList = (sortlist $PrefabList iA iB [naturalsort $iA $iB])
]

newgui "prefab_confirmdelete" [
	guistrut 28 1
	guialign 0 [guitext "^f7delete prefab, are you sure?" 0 ]
	guistrut 0.5
	guialign 0 [guiprefabpreview $PFB_DeleteMe 0xFF2010 [] 3.0 1 "" 1]
	guialign 0 [guitext (concatword "^f6" $PFB_DeleteMe) 0 ]
	guistrut 0.5
	guialign 0 [
		guibutton "^f2delete" [delprefab $PFB_DeleteMe; PFB_DeleteMe ""; GenPrefabList; cleargui 1]
		guistrut 5
		guibutton "^f7cancel" [cleargui 1]
	]
] 0


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	//MV_AAAAA = ""
]

newgui "map_vars" [
	guitext "Todo..."
] "map vars"


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
newgui "map_fog"            [guikeeptab 1; guiscale 0.6; guiposition 0 1; guistayopen [guinoautotab [MAP_Fog          ]]] "fog"
newgui "map_lighting"       [guikeeptab 1; guiscale 0.6; guiposition 0 1; guistayopen [guinoautotab [MAP_Lighting     ]]] "lighting"
newgui "map_materials"      [guikeeptab 1; guiscale 0.6; guiposition 0 1; guistayopen [guinoautotab [MAP_Materials    ]]] "materials"
newgui "map_sky_atmo"       [guikeeptab 1; guiscale 0.6; guiposition 0 1; guistayopen [guinoautotab [MAP_SkyAtmo      ]]] "atmo"
newgui "map_sky_cloudbox"   [guikeeptab 1; guiscale 0.6; guiposition 0 1; guistayopen [guinoautotab [MAP_SkyCloudbox  ]]] "cloudbox" [ComboList = (concat $CloudboxList $SkyboxList)]
newgui "map_sky_cloudlayer" [guikeeptab 1; guiscale 0.6; guiposition 0 1; guistayopen [guinoautotab [MAP_SkyCloudlayer]]] "cloudlayer"
newgui "map_sky_skybox"     [guikeeptab 1; guiscale 0.6; guiposition 0 1; guistayopen [guinoautotab [MAP_SkySkybox    ]]] "skybox"


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	defvar MV_FogColorR 0 0 255
	defvar MV_FogColorG 0 0 255
	defvar MV_FogColorB 0 0 255

	defvar MV_FogDomeColorR 0 0 255
	defvar MV_FogDomeColorG 0 0 255
	defvar MV_FogDomeColorB 0 0 255

	defvar MV_FogDomeMin 0 0 100 // 0.0 to 1.0
	defvar MV_FogDomeMax 0 0 100 // 0.0 to 1.0

	defvar MV_FogDomeClip      0 0 100 //  0.0 to 1.0
	defvar MV_FogDomeHeight -100 0 100 // -1.0 to 1.0
]

MAP_Fog = [
	guilist [// H
		guilist [// V
			guititle "fog"
			guistrut 0.25
			guifreerow  9  1 [ guitext "distance: "
					 ] 57 -2 [ guislider fog 128 16384
			]
			guistrut 1
			MV_FogColorR (& (>> $fogcolor 16) 0xFF)
			MV_FogColorG (& (>> $fogcolor  8) 0xFF)
			MV_FogColorB (&     $fogcolor     0xFF)
			guilist [// H
				guilist [// V
					guistrut 9 1
					guialign 1 [guitext "color: "]
					guistrut 1
					guialign 1 [guicolor $fogcolor; guistrut 1]
				]
				guilist [// V
					guistrut 57 1
					guislider MV_FogColorR 0 255 [fogcolor $MV_FogColorR $MV_FogColorG $MV_FogColorB]
					guislider MV_FogColorG 0 255 [fogcolor $MV_FogColorR $MV_FogColorG $MV_FogColorB]
					guislider MV_FogColorB 0 255 [fogcolor $MV_FogColorR $MV_FogColorG $MV_FogColorB]
				]
			]
		]
		guibar //-------------------------------------------------------------------------
		guilist [// V
			guititle "fogdome"
			guistrut 0.25
			MV_FogDomeColorR (& (>> $fogdomecolor 16) 0xFF)
			MV_FogDomeColorG (& (>> $fogdomecolor  8) 0xFF)
			MV_FogDomeColorB (&     $fogdomecolor     0xFF)
			guilist [// H
				guilist [// V
					guistrut 9 1
					guialign 1 [guitext "color: "]
					guistrut 1
					guialign 1 [guicolor $fogdomecolor; guistrut 1]
				]
				guilist [// V
					guistrut 57 1
					guislider MV_FogDomeColorR 0 255 [fogdomecolor $MV_FogDomeColorR $MV_FogDomeColorG $MV_FogDomeColorB]
					guislider MV_FogDomeColorG 0 255 [fogdomecolor $MV_FogDomeColorR $MV_FogDomeColorG $MV_FogDomeColorB]
					guislider MV_FogDomeColorB 0 255 [fogdomecolor $MV_FogDomeColorR $MV_FogDomeColorG $MV_FogDomeColorB]
				]
			]
			guistrut 0.5
			guilist [// H
				guilist [// V
					guistrut 9 1
					guialign 1 [guitext "min: "]
					guialign 1 [guitext "max: "]
					guistrut 0.5
					guialign 1 [guitext "clip: "]
					guialign 1 [guitext "height: "]
				]
				guilist [// V
					guistrut 57 1
					MV_FogDomeMin (*f $fogdomemin 100)
					MV_FogDomeMax (*f $fogdomemax 100)
					guislider MV_FogDomeMin 0 100 [fogdomemin (*f $MV_FogDomeMin 0.01)]
					guislider MV_FogDomeMax 0 100 [fogdomemax (*f $MV_FogDomeMax 0.01)]
					guistrut 0.5
					MV_FogDomeClip   (*f $fogdomeclip   100)
					MV_FogDomeHeight (*f $fogdomeheight 100)
					guislider MV_FogDomeClip      1 100 [fogdomeclip   (*f $MV_FogDomeClip   0.01)]
					guislider MV_FogDomeHeight -100 100 [fogdomeheight (*f $MV_FogDomeHeight 0.01)]
				]
			]
			guistrut 0.5
			guifreerow  9 -2 [
					 ] 18 -2 [ guicheckbox "over clouds"     fogdomeclouds
					 ] 18 -2 [ guicheckbox "squared falloff" fogdomesquare
					 ] 18 -2 [ guicheckbox "capped"          fogdomecap
			]
		]
	]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	defvar MV_SunLightR     0 0  255
	defvar MV_SunLightG     0 0  255 // 0, 0, 0xFFFFFF
	defvar MV_SunLightB     0 0  255
	defvar MV_SunLightScale 0 0 1600 // 0.0, 1.0, 16.0

	defvar MV_SkyLightR 0 0 255
	defvar MV_SkyLightG 0 0 255 // 0, 0, 0xFFFFFF
	defvar MV_SkyLightB 0 0 255

	defvar MV_AmbientR 0 0 255
	defvar MV_AmbientG 0 0 255 // 0, 0, 0xFFFFFF
	defvar MV_AmbientB 0 0 255
]

MAP_Lighting = [
	guialign 0 [// H
		guilist [// V
			guititle "sunlight"
			guistrut 0.5
			guifreerow  9  1 [ guitext "pitch: "
					 ] 48 -2 [ guislider sunlightpitch
			]
			guifreerow  9  1 [ guitext "yaw: "
					 ] 48 -2 [ guislider sunlightyaw
			]
			guilist [// H
				guistrut 9
				guibutton "get sun pitch & yaw from camera.  ^f2/getsundir" [getsundir]
			]
			guistrut 0.5
			guilist [// H
				guilist [// V
					guistrut 9 1
					guialign 1 [guitext "color: "]
					guistrut 1
					guialign 1 [guicolor $sunlight; guistrut 1]
				]
				guilist [// V
					guistrut 48 1
					MV_SunLightR (& (>> $sunlight 16) 0xFF)
					MV_SunLightG (& (>> $sunlight  8) 0xFF)
					MV_SunLightB (&     $sunlight     0xFF)
					guislider MV_SunLightR 0 255 [sunlight $MV_SunLightR $MV_SunLightG $MV_SunLightB]
					guislider MV_SunLightG 0 255 [sunlight $MV_SunLightR $MV_SunLightG $MV_SunLightB]
					guislider MV_SunLightB 0 255 [sunlight $MV_SunLightR $MV_SunLightG $MV_SunLightB]
				]
			]
			guistrut 0.5
			MV_SunLightScale (*f $sunlightscale 100)
			guifreerow  9  1 [ guitext "scale: "
					 ] 48 -2 [ guislider MV_SunLightScale 0 300 [sunlightscale (*f $MV_SunLightScale 0.01)]
			]
			guibar //-------------------------------------------------------------------------
			guilist [// H
				guistrut 9
				guibutton "set default skybox with lighting  ^f2/lettherebelight" [lettherebelight]
			]
		]
		guibar //-------------------------------------------------------------------------
		guilist [// V
			guititle "skylight"
			guistrut 0.5
			guilist [// H
				guilist [// V
					guistrut 9 1
					guialign 1 [guitext "color: "]
					guistrut 1
					guialign 1 [guicolor $skylight; guistrut 1]
				]
				guilist [// V
					guistrut 48 1
					MV_SkyLightR (& (>> $skylight 16) 0xFF)
					MV_SkyLightG (& (>> $skylight  8) 0xFF)
					MV_SkyLightB (&     $skylight     0xFF)
					guislider MV_SkyLightR 0 255 [skylight $MV_SkyLightR $MV_SkyLightG $MV_SkyLightB]
					guislider MV_SkyLightG 0 255 [skylight $MV_SkyLightR $MV_SkyLightG $MV_SkyLightB]
					guislider MV_SkyLightB 0 255 [skylight $MV_SkyLightR $MV_SkyLightG $MV_SkyLightB]
				]
			]
			guistrut 0.5
			guifreerow 9  1 [ guitext "blur: "
					 ] 4 -2 [ guiradio "0" blurskylight 0
					 ] 4 -2 [ guiradio "1" blurskylight 1
					 ] 4 -2 [ guiradio "2" blurskylight 2
			]
			guibar //-------------------------------------------------------------------------
			guititle "ambient"
			guistrut 0.5
			guilist [// H
				guilist [// V
					guistrut 9 1
					guialign 1 [guitext "color: "]
					guistrut 1
					guialign 1 [guicolor $ambient; guistrut 1]
				]
				guilist [// V
					guistrut 48 1
					MV_AmbientR (& (>> $ambient  16) 0xFF)
					MV_AmbientG (& (>> $ambient   8) 0xFF)
					MV_AmbientB (&     $ambient      0xFF)
					guislider MV_AmbientR 0 255 [ambient $MV_AmbientR $MV_AmbientG $MV_AmbientB]
					guislider MV_AmbientG 0 255 [ambient $MV_AmbientR $MV_AmbientG $MV_AmbientB]
					guislider MV_AmbientB 0 255 [ambient $MV_AmbientR $MV_AmbientG $MV_AmbientB]
				]
			]
		]
	]
	//=========================================================================================================================
	guitab "parameters"
	guialign 0 [// H
		guilist [// V
			guifreerow 12  1 [ guitext "blurskylight: "
					 ]  4 -2 [ guiradio "0" blurskylight 0
					 ]  4 -2 [ guiradio "1" blurskylight 1
					 ]  4 -2 [ guiradio "2" blurskylight 2
			]
			guifreerow 12  1 [ guitext "blurlightmaps: "
					 ]  4 -2 [ guiradio "0" blurlms 0
					 ]  4 -2 [ guiradio "1" blurlms 1
					 ]  4 -2 [ guiradio "2" blurlms 2
			]
			guistrut 0.5
			guifreerow 12  1 [ guitext "lightprecision: "
					 ] 48 -2 [ guilistslider lightprecision [8 12 16 24 32 48 64 96 128 192 256]
			]
			guifreerow 12  1 [ guitext "lightlod: "
					 ] 48 -2 [ guislider lightlod
							   guitext "^f9(>= use lightprecision, < use lightprecision/2)" 0
			]
			guistrut 0.5
			guifreerow 12  1 [ guitext "lighterror: "
					 ] 48 -2 [ guislider lighterror
			]
			guistrut 0.5
			guifreerow 12  1 [ guitext "lerpangle: "
					 ] 48 -2 [ guislider lerpangle
			]
		]
	]
	guitab "settings"
	guilist [// H
		guilist [// V
			guifreerow 12  1 [ guitext "lmaa: "
					 ] 10 -2 [ guiradio "^f9(0) ^f~none" lmaa 0
					 ] 10 -2 [ guiradio "^f9(1) ^f~4x?"  lmaa 1
					 ] 10 -2 [ guiradio "^f9(2) ^f~4x?"  lmaa 2
					 ]  1 -2 [ guiradio "^f9(3) ^f~8x"   lmaa 3
			]
			guistrut 0.25
			guifreerow 12  1 [ guitext "lmshadows: "
					 ] 10 -2 [ guiradio "^f9(0) ^f~none"            lmshadows 0
					 ] 10 -2 [ guiradio "^f9(1) ^f~cubes"           lmshadows 1
					 ]  1 -2 [ guiradio "^f9(2) ^f~cubes+mapmodels" lmshadows 2
			]
			guistrut 0.5
			guifreerow 12  1 [
					 ] 48 -2 [ guicheckbox "lerp t-joints" lerptjoints
			]
			guibar //-------------------------------------------------------------------------
			guistrut 0.125
			guifreerow 12  1 [ guitext "maxmerge: "
					 ] 48 -2 [ guislider maxmerge
			]
			guistrut 0.5
			guifreerow 12  1 [ guitext "lightthreads: "
					 ] 48 -2 [ guinameslider lightthreads ["auto" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16] [0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16]
			]
			//  adaptivesample 0, 2, 2     "1" seems to produce the least amount of lighting errors.
			guistrut 0.25
			guibar //-------------------------------------------------------------------------
			guistrut 0.25
			guilist [// H
				guistrut 12
				guicheckbox "fullbright  ^f2[L]" [fullbright]
			]
			guistrut 0.375
			guifreerow 12  1 [ guitext "fullbrightlevel: "
					 ] 48 -2 [ guislider fullbrightlevel
			]
		]
		guibar //-------------------------------------------------------------------------
		guilist [// V
			guistrut 54 1
			guilist [// H
				guispring
				guistrut 11.5 1
				guialign 0 [// V
					guibutton "calclight  ^f2[K]^t^f9(use vars)" [calclight]
					guistrut 1
					guibutton "calclight -1^t^f9(quick)" [calclight -1]
					guitext "^tlmaa = 0 ^tlmshadows = 1^tlerptjoints = 0"
					guistrut 0.5
					guibutton "calclight 1^t^f9(quality)" [calclight 1]
					guitext "^tlmaa = 3 ^tlmshadows = 2^tlerptjoints = 1"
					guistrut 2
					guibutton "clear lightmaps" [clearlightmaps]
					//guibutton "dump lightmap textures" [dumplms]
				]
				guispring
			]
		]
	]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	defvar MV_GlassColorR 0 0 255; defvar MV_Glass2ColorR 0 0 255; defvar MV_Glass3ColorR 0 0 255; defvar MV_Glass4ColorR 0 0 255
	defvar MV_GlassColorG 0 0 255; defvar MV_Glass2ColorG 0 0 255; defvar MV_Glass3ColorG 0 0 255; defvar MV_Glass4ColorG 0 0 255
	defvar MV_GlassColorB 0 0 255; defvar MV_Glass2ColorB 0 0 255; defvar MV_Glass3ColorB 0 0 255; defvar MV_Glass4ColorB 0 0 255

	defvar MV_LavaColorR 0 0 255; defvar MV_Lava2ColorR 0 0 255; defvar MV_Lava3ColorR 0 0 255; defvar MV_Lava4ColorR 0 0 255
	defvar MV_LavaColorG 0 0 255; defvar MV_Lava2ColorG 0 0 255; defvar MV_Lava3ColorG 0 0 255; defvar MV_Lava4ColorG 0 0 255
	defvar MV_LavaColorB 0 0 255; defvar MV_Lava2ColorB 0 0 255; defvar MV_Lava3ColorB 0 0 255; defvar MV_Lava4ColorB 0 0 255

	defvar MV_WaterColorR 0 0 255; defvar MV_Water2ColorR 0 0 255; defvar MV_Water3ColorR 0 0 255; defvar MV_Water4ColorR 0 0 255
	defvar MV_WaterColorG 0 0 255; defvar MV_Water2ColorG 0 0 255; defvar MV_Water3ColorG 0 0 255; defvar MV_Water4ColorG 0 0 255
	defvar MV_WaterColorB 0 0 255; defvar MV_Water2ColorB 0 0 255; defvar MV_Water3ColorB 0 0 255; defvar MV_Water4ColorB 0 0 255

	defvar MV_WaterFallColorR 0 0 255; defvar MV_Water2FallColorR 0 0 255; defvar MV_Water3FallColorR 0 0 255; defvar MV_Water4FallColorR 0 0 255
	defvar MV_WaterFallColorG 0 0 255; defvar MV_Water2FallColorG 0 0 255; defvar MV_Water3FallColorG 0 0 255; defvar MV_Water4FallColorG 0 0 255
	defvar MV_WaterFallColorB 0 0 255; defvar MV_Water2FallColorB 0 0 255; defvar MV_Water3FallColorB 0 0 255; defvar MV_Water4FallColorB 0 0 255
]

MAP_Materials = [
	guistrut 77 1
	guititle "apply material"
	guistrut 0.5
	guialign 0 [// H
		guistrut 1
		guilist [// V
			guistrut 14 1
			guibutton "^f7air ^f9(reset)" [editmat air]
			guistrut 0.25
			guibutton "^f3clip"           [editmat clip]
			guistrut 0.25
			guibutton "^f0noclip"         [editmat noclip]
		]
		guilist [// V
			guistrut 14 1
			guibutton "^f5alpha"    [editmat alpha]
			guistrut 0.25
			guibutton "^f4death"    [editmat death]
			guistrut 0.25
			guibutton "^f2gameclip" [editmat gameclip]
		]
		guilist [// V
			guistrut 9 1
			guibutton "^f8glass" [editmat glass]
			guistrut 0.25
			guibutton "^f6lava"  [editmat lava]
			guistrut 0.25
			guibutton "^f1water" [editmat water]
		]
		guilist [// V
			guistrut 9 1
			guibutton "^f8glass2" [editmat glass2]
			guistrut 0.25
			guibutton "^f6lava2"  [editmat lava2]
			guistrut 0.25
			guibutton "^f1water2" [editmat water2]
		]
		guilist [// V
			guistrut 9 1
			guibutton "^f8glass3" [editmat glass3]
			guistrut 0.25
			guibutton "^f6lava3"  [editmat lava3]
			guistrut 0.25
			guibutton "^f1water3" [editmat water3]
		]
		guilist [// V
			guistrut 9 1
			guibutton "^f8glass4" [editmat glass4]
			guistrut 0.25
			guibutton "^f6lava4"  [editmat lava4]
			guistrut 0.25
			guibutton "^f1water4" [editmat water4]
		]
	]
	guistrut 2
	guialign 0 [
		guistrut 2 1
		guicheckbox "show material volumes ^f2[M]" showmat
	]
	guitab "glass"; if (= $guitabnum  2) [MAP_MAT_Glass ""]
	guitab "2"    ; if (= $guitabnum  3) [MAP_MAT_Glass "2"]
	guitab "3"    ; if (= $guitabnum  4) [MAP_MAT_Glass "3"]
	guitab "4"    ; if (= $guitabnum  5) [MAP_MAT_Glass "4"]
	guitab "lava" ; if (= $guitabnum  6) [MAP_MAT_Lava ""]
	guitab "2"    ; if (= $guitabnum  7) [MAP_MAT_Lava "2"]
	guitab "3"    ; if (= $guitabnum  8) [MAP_MAT_Lava "3"]
	guitab "4"    ; if (= $guitabnum  9) [MAP_MAT_Lava "4"]
	guitab "water"; if (= $guitabnum 10) [MAP_MAT_Water ""]
	guitab "2"    ; if (= $guitabnum 11) [MAP_MAT_Water "2"]
	guitab "3"    ; if (= $guitabnum 12) [MAP_MAT_Water "3"]
	guitab "4"    ; if (= $guitabnum 13) [MAP_MAT_Water "4"]
]

MAP_MAT_Glass = [
	local GlsClr GlsClrR GlsClrG GlsClrB
	GlsClr  = (concatword "glass" $arg1 "color")
	GlsClrR = (concatword "MV_Glass" $arg1 "ColorR")
	GlsClrG = (concatword "MV_Glass" $arg1 "ColorG")
	GlsClrB = (concatword "MV_Glass" $arg1 "ColorB")
	guilist [// H
		guilist [// V
			guistrut 13 1
			guialign 1 [guitext "color: "]
			guistrut 1
			guialign 1 [guicolor $@GlsClr; guistrut 1]
		]
		guilist [// V
			guistrut 64 1
			@GlsClrR = (& (>> $@GlsClr 16) 0xFF)
			@GlsClrG = (& (>> $@GlsClr  8) 0xFF)
			@GlsClrB = (&     $@GlsClr     0xFF)
			guislider @GlsClrR 0 255 [@GlsClr $@GlsClrR $@GlsClrG $@GlsClrB]
			guislider @GlsClrG 0 255 [@GlsClr $@GlsClrR $@GlsClrG $@GlsClrB]
			guislider @GlsClrB 0 255 [@GlsClr $@GlsClrR $@GlsClrG $@GlsClrB]
		]
	]
]

MAP_MAT_Lava = [
	local LvaClr LvaClrR LvaClrG LvaClrB
	LvaClr  = (concatword "lava" $arg1 "color")
	LvaClrR = (concatword "MV_Lava" $arg1 "ColorR")
	LvaClrG = (concatword "MV_Lava" $arg1 "ColorG")
	LvaClrB = (concatword "MV_Lava" $arg1 "ColorB")
	guilist [// H
		guilist [// V
			guistrut 13 1
			guialign 1 [guitext "color: "]
			guistrut 1
			guialign 1 [guicolor $@LvaClr; guistrut 1]
			guistrut 0.5
			guialign 1 [guitext "fog distance: "]
		]
		guilist [// V
			guistrut 64 1
			@LvaClrR = (& (>> $@LvaClr 16) 0xFF)
			@LvaClrG = (& (>> $@LvaClr  8) 0xFF)
			@LvaClrB = (&     $@LvaClr     0xFF)
			guislider @LvaClrR 0 255 [@LvaClr $@LvaClrR $@LvaClrG $@LvaClrB]
			guislider @LvaClrG 0 255 [@LvaClr $@LvaClrR $@LvaClrG $@LvaClrB]
			guislider @LvaClrB 0 255 [@LvaClr $@LvaClrR $@LvaClrG $@LvaClrB]
			guistrut 0.5
			guislider @(concatword "lava" $arg1 "fog") 0 1024
		]
	]
]

MAP_MAT_Water = [
	local WtrClr WtrFllClr WtrClrR WtrClrG WtrClrB WtrFllClrR WtrFllClrG WtrFllClrB
	WtrClr     = (concatword "water" $arg1 "color")
	WtrFllClr  = (concatword "water" $arg1 "fallcolor")
	WtrClrR    = (concatword "MV_Water" $arg1 "ColorR")
	WtrClrG    = (concatword "MV_Water" $arg1 "ColorG")
	WtrClrB    = (concatword "MV_Water" $arg1 "ColorB")
	WtrFllClrR = (concatword "MV_Water" $arg1 "FallColorR")
	WtrFllClrG = (concatword "MV_Water" $arg1 "FallColorG")
	WtrFllClrB = (concatword "MV_Water" $arg1 "FallColorB")
	guilist [// H
		guilist [// V
			guistrut 13 1
			guialign 1 [guitext "color: "]
			guistrut 1
			guialign 1 [guicolor $@WtrClr; guistrut 1]
			guistrut 0.5
			guialign 1 [guitext "fog distance: "]
			guialign 1 [guitext "surface spec: "]
			guistrut 0.5
			guialign 1 [guitext "waterfall color: "]
			guistrut 1
			guialign 1 [guicolor $@WtrFllClr; guistrut 1]
		]
		guilist [// V
			guistrut 64 1
			@WtrClrR = (& (>> $@WtrClr 16) 0xFF)
			@WtrClrG = (& (>> $@WtrClr  8) 0xFF)
			@WtrClrB = (&     $@WtrClr     0xFF)
			guislider @WtrClrR 0 255 [@WtrClr $@WtrClrR $@WtrClrG $@WtrClrB]
			guislider @WtrClrG 0 255 [@WtrClr $@WtrClrR $@WtrClrG $@WtrClrB]
			guislider @WtrClrB 0 255 [@WtrClr $@WtrClrR $@WtrClrG $@WtrClrB]
			guistrut 0.5
			guislider @(concatword "water" $arg1 "fog") 0 1024
			guislider @(concatword "water" $arg1 "spec")
			guistrut 0.5
			@WtrFllClrR = (& (>> $@WtrFllClr 16) 0xFF)
			@WtrFllClrG = (& (>> $@WtrFllClr  8) 0xFF)
			@WtrFllClrB = (&     $@WtrFllClr     0xFF)
			guislider @WtrFllClrR 0 255 [@WtrFllClr $@WtrFllClrR $@WtrFllClrG $@WtrFllClrB]
			guislider @WtrFllClrG 0 255 [@WtrFllClr $@WtrFllClrR $@WtrFllClrG $@WtrFllClrB]
			guislider @WtrFllClrB 0 255 [@WtrFllClr $@WtrFllClrR $@WtrFllClrG $@WtrFllClrB]
		]
	]
]

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	defvar MAP_Atmo__ShowSunlight 0 0 1

	defvar MV_AtmoAlpha         0 0  255 // atmoalpha         0    ,  1.0,    1.0
	defvar MV_AtmoBright        0 0 1600 // atmobright        0    ,  1.0,   16.0
	defvar MV_AtmoDensity       0 0 1600 // atmodensity       0    ,  1.0,   16.0
	defvar MV_AtmoHaze          0 0 1600 // atmohaze          0    ,  0.1,   16.0
	defvar MV_AtmoHeight        0 0 1000 // atmoheight        0.001,  1.0, 1000.0
	defvar MV_AtmoOzone         0 0 1600 // atmoozone         0    ,  1.0,   16.0
	defvar MV_AtmoPlanetSize    0 0 1000 // atmoplanetsize    0.001,  1.0, 1000.0
	defvar MV_AtmoSunDiskR      0 0  255
	defvar MV_AtmoSunDiskG      0 0  255 // atmosundisk       0    ,  0.0, 0xFFFFFF
	defvar MV_AtmoSunDiskB      0 0  255
	defvar MV_AtmoSunDiskBright 0 0 1600 // atmosundiskbright 0    ,  1.0,   16.0
	defvar MV_AtmoSunDiskCorona 0 0  100 // atmosundiskcorona 0    ,  0.4,    1.0
	defvar MV_AtmoSunDiskSize   0 0  900 // atmosundisksize   0    , 12.0,   90.0
	defvar MV_AtmoSunLightR     0 0  255
	defvar MV_AtmoSunLightG     0 0  255 // atmosunlight      0    ,  0.0, 0xFFFFFF
	defvar MV_AtmoSunLightB     0 0  255
	defvar MV_AtmoSunLightScale 0 0 1600 // atmosunlightscale 0    ,  1.0,   16.0
]

MAP_SkyAtmo = [
	guilist [// H
		guilist [// V
			guialign 0 [
				guicheckbox "atmo sky" atmo
				guispring
				guicheckbox "show sunlight" MAP_Atmo__ShowSunlight
				guispring
				guistayopen [guibutton "RESET" [MAP_SkyAtmoReset]]
			]
			guistrut 0.5 //guibar
			guilist [// H
				guilist [// V
					guistrut 13 1
					guialign 1 [guitext "alpha: "]
				]
				guilist [// V
					guistrut 48 1
					MV_AtmoAlpha (*f $atmoalpha 255)
					guislider MV_AtmoAlpha 0 255 [atmoalpha (*f $MV_AtmoAlpha (divf 1 255))]
				]
			]
			guibar
			guititle "atmosphere"
			guistrut 0.25
			guilist [// H
				guilist [// V
					guistrut 13 1
					guialign 1 [guitext "bright: "]
					guistrut 0.5
					guialign 1 [guitext "density: "]
					guialign 1 [guitext "haze: "]
					guialign 1 [guitext "ozone: "]
					guistrut 0.5
					guialign 1 [guitext "height: "]
					guialign 1 [guitext "planetsize: "]
				]
				guilist [// V
					guistrut 48 1
					MV_AtmoBright     (*f $atmobright     100)
					MV_AtmoDensity    (*f $atmodensity    100)
					MV_AtmoHaze       (*f $atmohaze       100)
					MV_AtmoHeight     (*f $atmoheight     100)
					MV_AtmoOzone      (*f $atmoozone      100)
					MV_AtmoPlanetSize (*f $atmoplanetsize 100)
					guislider MV_AtmoBright     0 1600 [atmobright     (*f $MV_AtmoBright     0.01)]
					guistrut 0.5
					guislider MV_AtmoDensity    0 1600 [atmodensity    (*f $MV_AtmoDensity    0.01)]
					guislider MV_AtmoHaze       0 1600 [atmohaze       (*f $MV_AtmoHaze       0.01)]
					guislider MV_AtmoOzone      0 1600 [atmoozone      (*f $MV_AtmoOzone      0.01)]
					guistrut 0.5
					guislider MV_AtmoHeight     1 1000 [atmoheight     (*f $MV_AtmoHeight     0.01)] //  Vertical-size/depth of atmosphere.
					guislider MV_AtmoPlanetSize 1 1000 [atmoplanetsize (*f $MV_AtmoPlanetSize 0.01)] //  Atmosphere "shape" / falloff towards horizon.
				]
			]
			if $MAP_Atmo__ShowSunlight [
				guibar
				MAP_SkyAtmoSunDisk
			]
		]
		guibar
		guilist [// V
			if (! $MAP_Atmo__ShowSunlight) [
				MAP_SkyAtmoSunDisk
				guibar
			]
			guititle "atmo sunlight"
			guistrut 0.25
			MV_AtmoSunLightR (& (>> $atmosunlight 16) 0xFF)
			MV_AtmoSunLightG (& (>> $atmosunlight  8) 0xFF)
			MV_AtmoSunLightB (&     $atmosunlight     0xFF)
			MV_AtmoSunLightScale (*f $atmosunlightscale 100)
			guilist [// H
				guilist [// V
					guistrut 13 1
					guialign 1 [guitext "color: "]
					guialign 1 [guitext "^f90=use sunlight "]
					guialign 1 [guicolor $atmosunlight; guistrut 1]
					guistrut 0.5
					guialign 1 [guitext "color scale: "]
				]
				guilist [// V
					guistrut 48 1
					guislider MV_AtmoSunLightR 0 255 [atmosunlight $MV_AtmoSunLightR $MV_AtmoSunLightG $MV_AtmoSunLightB]
					guislider MV_AtmoSunLightG 0 255 [atmosunlight $MV_AtmoSunLightR $MV_AtmoSunLightG $MV_AtmoSunLightB]
					guislider MV_AtmoSunLightB 0 255 [atmosunlight $MV_AtmoSunLightR $MV_AtmoSunLightG $MV_AtmoSunLightB]
					guistrut 0.5
					guislider MV_AtmoSunLightScale 0 500 [atmosunlightscale (*f $MV_AtmoSunLightScale 0.01)]
				]
			]
			if $MAP_Atmo__ShowSunlight [
				guibar
				MAP_Atmo_SunLight
			]
		]
	]
]

//#############################################################################################################################################
MAP_SkyAtmoReset = [
	atmoalpha           1.0
	atmobright          1.0
	atmodensity         1.0
	atmohaze            0.1
	atmoheight          1.0
	atmoozone           1.0
	atmoplanetsize      1.0
	atmosundisk         0x0
	atmosundiskbright   1.0
	atmosundiskcorona   0.4
	atmosundisksize    12.0
	atmosunlight        0x0
	atmosunlightscale   1.0
]

//#############################################################################################################################################
MAP_SkyAtmoSunDisk = [
	guititle "sundisk"
	guistrut 0.25
	MV_AtmoSunDiskR (& (>> $atmosundisk 16) 0xFF)
	MV_AtmoSunDiskG (& (>> $atmosundisk  8) 0xFF)
	MV_AtmoSunDiskB (&     $atmosundisk     0xFF)
	MV_AtmoSunDiskBright (*f $atmosundiskbright 100)
	MV_AtmoSunDiskCorona (*f $atmosundiskcorona 100)
	MV_AtmoSunDiskSize   (*f $atmosundisksize    10)
	guilist [// H
		guilist [// V
			guistrut 13 1
			guialign 1 [guitext "color: "]
			guialign 1 [guitext "^f90=use sunlight "]
			guialign 1 [guicolor $atmosundisk; guistrut 1]
			guistrut 0.5
			guialign 1 [guitext "bright: "]
			guialign 1 [guitext "corona: "]
			guialign 1 [guitext "size: "]
		]
		guilist [// V
			guistrut 48 1
			guislider MV_AtmoSunDiskR 0 255 [atmosundisk $MV_AtmoSunDiskR $MV_AtmoSunDiskG $MV_AtmoSunDiskB]
			guislider MV_AtmoSunDiskG 0 255 [atmosundisk $MV_AtmoSunDiskR $MV_AtmoSunDiskG $MV_AtmoSunDiskB]
			guislider MV_AtmoSunDiskB 0 255 [atmosundisk $MV_AtmoSunDiskR $MV_AtmoSunDiskG $MV_AtmoSunDiskB]
			guistrut 0.5
			guislider MV_AtmoSunDiskBright 0 1600 [atmosundiskbright (*f $MV_AtmoSunDiskBright 0.01)]
			guislider MV_AtmoSunDiskCorona 0  100 [atmosundiskcorona (*f $MV_AtmoSunDiskCorona 0.01)]
			guislider MV_AtmoSunDiskSize   0  900 [atmosundisksize   (*f $MV_AtmoSunDiskSize   0.1 )]
		]
	]
]

//#############################################################################################################################################
MAP_Atmo_SunLight = [
	guititle "sunlight"
	guistrut 0.25
	guilist [// H
		guilist [// V
			guistrut 13 1
			guialign 1 [guitext "color: "]
			guistrut 1
			guialign 1 [guicolor $sunlight; guistrut 1]
			guistrut 0.5
			guialign 1 [guitext "color scale: "]
			guistrut 0.5
			guialign 1 [guitext "pitch: "]
			guialign 1 [guitext "yaw: "]
		]
		guilist [// V
			guistrut 48 1
			MV_SunLightR (& (>> $sunlight 16) 0xFF)
			MV_SunLightG (& (>> $sunlight  8) 0xFF)
			MV_SunLightB (&     $sunlight     0xFF)
			guislider MV_SunLightR 0 255 [sunlight $MV_SunLightR $MV_SunLightG $MV_SunLightB]
			guislider MV_SunLightG 0 255 [sunlight $MV_SunLightR $MV_SunLightG $MV_SunLightB]
			guislider MV_SunLightB 0 255 [sunlight $MV_SunLightR $MV_SunLightG $MV_SunLightB]
			guistrut 0.5
			MV_SunLightScale (*f $sunlightscale 100)
			guislider MV_SunLightScale 0 500 [sunlightscale (*f $MV_SunLightScale 0.01)]
			guistrut 0.5
			guislider sunlightpitch
			guislider sunlightyaw
		]
	]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	defvar MV_NumOfCloudCols 1  1 0
	defvar MV_NumOfCloudRows 1 15 0

	defsvar MV_CloudBox ""

	defvar MV_CloudboxColorR 0 0  255
	defvar MV_CloudboxColorG 0 0  255 //  0  0xFFFFFF
	defvar MV_CloudboxColorB 0 0  255
	defvar MV_CloudboxAlpha  0 0  255 //    0.0    1.0
	defvar MV_CloudClip      0 0 1000 //    0.0    1.0
	defvar MV_SpinClouds -7200 0 7200 // -720.0  720.0

	defvar MV_Cloudbox_ShowSkies 0 0 1

	CloudboxList = ""
	ComboList    = ""
]

MAP_SkyCloudbox = [
	guilist [// H
		if $MV_Cloudbox_ShowSkies [
			loop iCol (ceil (divf (listlen $ComboList) 15)) [
				guilist [
					guistrut 24 1
					loopsublist iSky $ComboList (* $iCol $MV_NumOfCloudRows) $MV_NumOfCloudRows [guibutton $iSky (concat cloudbox $iSky)]
				]
			]
		][
			loop iCol $MV_NumOfCloudCols [
				guilist [
					guistrut 24 1
					loopsublist iSky $CloudboxList (* $iCol $MV_NumOfCloudRows) $MV_NumOfCloudRows [guibutton $iSky (concat cloudbox $iSky)]
				]
			]
		]
		guispring
		guibar
		guilist [// V
			MV_Skybox = (checkrolloveraction "cloudbox " [if (> $numargs 0) [result $arg1] [at $guirollovername 0]])
			guiimage (concatword "<thumbnail:256>packages/" $MV_Skybox "_ft") (checkrolloveraction "cloudbox ") 6 0 "data/cardboard_missing.png" ""
			guibar
			guialign 0 [guitext (concatword "^f7cloudbox: ^f~^"" (chopstr $cloudbox -16 "..") "^"")]
			guistrut 0.25
			guialign 0 [guicheckbox "show skyboxes " MV_Cloudbox_ShowSkies 1 0 [ComboList = (concat $CloudboxList $SkyboxList)]]
		]
	]
	//=========================================================================================================================
	guitab "parameters"
	guialign 0 [// H
		guilist [// V
			guilist [// H
				guilist [// V
					guistrut 8 1
					guialign 1 [guitext "color: "]
					guistrut 1
					guialign 1 [guicolor $cloudboxcolor; guistrut 1]
					guistrut 0.5
					guialign 1 [guitext "alpha: "]
				]
				guilist [// V
					guistrut 64 1
					MV_CloudboxColorR (& (>> $cloudboxcolor 16) 0xFF)
					MV_CloudboxColorG (& (>> $cloudboxcolor  8) 0xFF)
					MV_CloudboxColorB (&     $cloudboxcolor     0xFF)
					guislider MV_CloudboxColorR 0 255 [cloudboxcolor $MV_CloudboxColorR $MV_CloudboxColorG $MV_CloudboxColorB]
					guislider MV_CloudboxColorG 0 255 [cloudboxcolor $MV_CloudboxColorR $MV_CloudboxColorG $MV_CloudboxColorB]
					guislider MV_CloudboxColorB 0 255 [cloudboxcolor $MV_CloudboxColorR $MV_CloudboxColorG $MV_CloudboxColorB]
					guistrut 0.5
					MV_CloudboxAlpha (*f $cloudboxalpha 255)
					guislider MV_CloudboxAlpha 0 255 [cloudboxalpha (*f $MV_CloudboxAlpha (divf 1 255))]
				]
			]
			guistrut 1
			guilist [// H
				guilist [// V
					guistrut 8 1
					guialign 1 [guitext "clip: "]
					guistrut 0.5
					guialign 1 [guitext "spin: "]
					guistrut 0.5
					guialign 1 [guitext "yaw: "]
				]
				guilist [// V
					guistrut 64 1
					MV_CloudClip (*f $cloudclip 1000)
					guislider MV_CloudClip 0 1000 [cloudclip (*f $MV_CloudClip 0.001)]
					guistrut 0.5
					MV_SpinSky (*f $spinclouds 10)
					guislider MV_SpinSky -200 200 [spinclouds (*f $MV_SpinSky 0.1)]
					guistrut 0.5
					guislider yawclouds
				]
			]
		]
	]
]

CloudboxList = [
	"skyboxes/lordkv/saturn"
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	defsvar MV_CloudLayer ""

	defvar MV_CloudAlpha         0 0   255 // 0.0  1.0
	defvar MV_CloudColorR        0 0   255
	defvar MV_CloudColorG        0 0   255 // 0  0xFFFFFF
	defvar MV_CloudColorB        0 0   255
	defvar MV_CloudFade          0 0  1000 //    0.0      1.0
	defvar MV_CloudHeight    -1000 0  1000 //   -1.0      1.0
	defvar MV_CloudOffsetX       0 0  1000 //    0.0      1.0
	defvar MV_CloudOffsetY       0 0  1000 //    0.0      1.0
	defvar MV_CloudScale         1 0 64000 //    0.001   64.0
	defvar MV_CloudScrollX  -16000 0 16000 //  -16.0     16.0
	defvar MV_CloudScrollY  -16000 0 16000 //  -16.0     16.0
	defvar MV_SpinCloudLayer -7200 0  7200 // -720.0    720.0
]

MAP_SkyCloudlayer = [
	guialign 0 [// H
		guilist [// V
			guistrut 32 1
			guibutton "^f8*no_clouds*" [cloudlayer ""]
			guibutton "skyboxes/cloud_ring.png"      [cloudlayer "skyboxes/cloud_ring.png"]
			guibutton "skyboxes/clouds01.png"        [cloudlayer "skyboxes/clouds01.png"]
			guibutton "skyboxes/clouds02.png"        [cloudlayer "skyboxes/clouds02.png"]
			guibutton "skyboxes/clouds03.png"        [cloudlayer "skyboxes/clouds03.png"]
			guibutton "razgriz/cloud03.png"          [cloudlayer "razgriz/cloud03.png"]
			guibutton "razgriz/cloud04.png"          [cloudlayer "razgriz/cloud04.png"]
		]
		guibar
		guilist [// V
			MV_CloudLayer = (checkrolloveraction "cloudlayer " [at $guirollovername 0])
			guiimage (concatword "<thumbnail:128>packages/" $MV_CloudLayer) (checkrolloveraction "cloudlayer ") 6 0 "data/cardboard_missing.png" ""
			guibar
			guialign 0 [guitext (concatword "^f7cloudlayer: ^f~^"" (chopstr $cloudlayer -17 "..") "^"")]
		]
	]
	//=========================================================================================================================
	guitab "parameters"
	guilist [// H
		guistrut 12 1
		guilist [// V
			guititle "appearance"
			guistrut 0.25
			guilist [// H
				guilist [// V
					guistrut 9 1
					guialign 1 [guitext "color: " 0]
					guistrut 1
					guialign 1 [guicolor $cloudcolor; guistrut 1]
				]
				guilist [// V
					guistrut 56 1
					MV_CloudColorR (& (>> $cloudcolor 16) 0xFF)
					MV_CloudColorG (& (>> $cloudcolor  8) 0xFF)
					MV_CloudColorB (&     $cloudcolor     0xFF)
					guislider MV_CloudColorR 0 255 [cloudcolor $MV_CloudColorR $MV_CloudColorG $MV_CloudColorB]
					guislider MV_CloudColorG 0 255 [cloudcolor $MV_CloudColorR $MV_CloudColorG $MV_CloudColorB]
					guislider MV_CloudColorB 0 255 [cloudcolor $MV_CloudColorR $MV_CloudColorG $MV_CloudColorB]
				]
			]
			guistrut 0.5
			guilist [// H
				guilist [// V
					guistrut 9 1
					guialign 1 [guitext "alpha: " 0]
					guistrut 0.5
					guialign 1 [guitext "fade: " 0]
				]
				guilist [// V
					guistrut 56 1
					MV_CloudAlpha (*f $cloudalpha 255)
					guislider MV_CloudAlpha 0 255 [cloudalpha (*f $MV_CloudAlpha (divf 1 255))]
					guistrut 0.5
					MV_CloudFade (*f $cloudfade 1000)
					guislider MV_CloudFade  0 1000 [cloudfade  (*f $MV_CloudFade  0.001)]
				]
			]
		]
		guibar
		guilist [// V
			guititle "position"
			guistrut 0.25
			guilist [// H
				guilist [// V
					guistrut 8 1
					guialign 1 [guitext "offset x: "]
					guialign 1 [guitext "offset y: "]
					guistrut 0.5
					guialign 1 [guitext "height: "]
					guialign 1 [guitext "scale: "]
					guistrut 0.5
					guialign 1 [guitext "yaw: "]
				]
				guilist [// V
					guistrut 56 1
					MV_CloudOffsetX (*f $cloudoffsetx 1000)
					MV_CloudOffsetY (*f $cloudoffsety 1000)
					guislider MV_CloudOffsetX 0 1000 [cloudoffsetx (*f $MV_CloudOffsetX 0.001)]
					guislider MV_CloudOffsetY 0 1000 [cloudoffsety (*f $MV_CloudOffsetY 0.001)]
					guistrut 0.5
					MV_CloudHeight (*f $cloudheight 100)
					MV_CloudScale  (*f $cloudscale  100)
					guislider MV_CloudHeight -100 100 [cloudheight (*f $MV_CloudHeight 0.01)]
					guislider MV_CloudScale     1 400 [cloudscale  (*f $MV_CloudScale  0.01)]
					guistrut 0.5
					guislider yawcloudlayer
				]
			]
			guistrut 1
			guititle "animation"
			guistrut 0.25
			guilist [// H
				guilist [// V
					guistrut 8 1
					guialign 1 [guitext "scroll x: "]
					guialign 1 [guitext "scroll y: "]
					guistrut 0.5
					guialign 1 [guitext "spin: "]
				]
				guilist [// V
					guistrut 56 1
					MV_CloudScrollX (*f $cloudscrollx 10000)
					MV_CloudScrollY (*f $cloudscrolly 10000)
					guislider MV_CloudScrollX 0 1000 [cloudscrollx (*f $MV_CloudScrollX 0.0001)]
					guislider MV_CloudScrollY 0 1000 [cloudscrolly (*f $MV_CloudScrollY 0.0001)]
					guistrut 0.5
					MV_SpinCloudLayer (*f $spincloudlayer 10)
					guislider MV_SpinCloudLayer -200 200 [spincloudlayer (*f $MV_SpinCloudLayer 0.1)]
				]
			]
		]
	]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// TODO make this a tabbed UI

nodebug [
	defvar MV_NumOfSkyCols 1  4 0
	defvar MV_NumOfSkyRows 1 15 0

	defsvar MV_Skybox ""

	defvar MV_SkyboxColorR 0 0 255
	defvar MV_SkyboxColorG 0 0 255
	defvar MV_SkyboxColorB 0 0 255

	defvar MV_SpinSky -7200 0 7200 // -720.0  720.0

	SkyboxList = ""
]

MAP_SkySkybox = [
	guilist [// H
		loop iCol $MV_NumOfSkyCols [
			guilist [
				guistrut 24 1
				loopsublist iSky $SkyboxList (* $iCol $MV_NumOfSkyRows) $MV_NumOfSkyRows [guibutton $iSky (concat skybox $iSky)]
			]
		]
		guibar
		guilist [// V
			MV_Skybox = (checkrolloveraction "skybox " [if (> $numargs 0) [result $arg1] [at $guirollovername 0]])
			guiimage (concatword "<thumbnail:256>packages/" $MV_Skybox "_ft") (checkrolloveraction "skybox ") 6 0 "data/cardboard_missing.png" ""
			guibar
			guialign 0 [guitext (concatword "^f7skybox: ^f~^"" (chopstr $skybox -17 "..") "^"")]
		]
	]
	//=========================================================================================================================
	guitab "parameters"
	guialign 0 [// H
		guilist [// V
			guilist [// H
				guilist [// V
					guistrut 8 1
					guialign 1 [guitext "color: "]
					guistrut 1
					guialign 1 [guicolor $skyboxcolor; guistrut 1]
				]
				guilist [// V
					guistrut 64 1
					MV_SkyboxColorR (& (>> $skyboxcolor 16) 0xFF)
					MV_SkyboxColorG (& (>> $skyboxcolor  8) 0xFF)
					MV_SkyboxColorB (&     $skyboxcolor     0xFF)
					guislider MV_SkyboxColorR 0 255 [skyboxcolor $MV_SkyboxColorR $MV_SkyboxColorG $MV_SkyboxColorB]
					guislider MV_SkyboxColorG 0 255 [skyboxcolor $MV_SkyboxColorR $MV_SkyboxColorG $MV_SkyboxColorB]
					guislider MV_SkyboxColorB 0 255 [skyboxcolor $MV_SkyboxColorR $MV_SkyboxColorG $MV_SkyboxColorB]
				]
			]
			guistrut 1
			guilist [// H
				guilist [// V
					guistrut 8 1
					guialign 1 [guitext "yaw: "]
					guistrut 1
					guialign 1 [guitext "spin: "]
				]
				guilist [// V
					guistrut 64 1
					guislider yawsky
					guistrut 1
					MV_SpinSky (*f $spinsky 10)
					guislider MV_SpinSky -200 200 [spinsky (*f $MV_SpinSky 0.1)]
				]
			]
		]
	]
]

SkyboxList = [
	mayhem/afterrain
	mayhem/aqua4
	mayhem/aqua9
	mayhem/coulee
	mayhem/duomo
	mayhem/eclipse
	mayhem/grouse
	mayhem/flame
	mayhem/forestrytwo
	mayhem/h2s
	mayhem/prehistoric
	mayhem/scorched
	mayhem/shattered
	mayhem/trough
	penguins/arid
	penguins/arid2
	penguins/barren
	penguins/battery
	penguins/bay
	penguins/blizzard
	penguins/cocoa
	penguins/desertdawn
	penguins/divine
	penguins/dusk
	penguins/dust
	penguins/flames
	penguins/gloom
	penguins/harmony
	penguins/haze
	penguins/heather
	penguins/humble
	penguins/indigo
	penguins/kenon_star
	penguins/majik
	penguins/meadow
	penguins/mellow
	penguins/morning
	penguins/mystic
	penguins/ocean
	penguins/overcast
	penguins/paze
	penguins/pit
	penguins/quirk
	penguins/raspberry
	penguins/serenity
	penguins/sleepyhollow
	penguins/sun
	penguins/tears
	penguins/torture
	penguins/trance
	penguins/tropic
	penguins/trouble
	penguins/valley
	penguins/violence
	penguins/vulcan
	penguins/wasteland
	penguins/wrath
	penguins/yonder
	penguins/zeus
	skyboxes/black
	skyboxes/clearsky052
	skyboxes/darkness
	skyboxes/evilsky
	skyboxes/morning
	skyboxes/remus/sky01
	skyboxes/white
	spiney/gloomy
	staffy/staffy
	ulukai/redeclipse
	ulukai/corona
	red/clouds
	red/gradient
	red/grey
	red/interstellar
	red/miramar
	red/skyhigh
	red/skylump
	red/skylump2
	red/stars
	red/stormydays
	red/sunsetflat
	red/yellow
	loopix/daysky
	skorpio/weltraum
	kurt/space
	skyboxes/test/test
	bkg/blue/bkg1
	bkg/lightblue/bkg1
	bkg/red/bkg1
	bkg/red/bkg2
	bkg/red/bkg3
	elyvisions/arch3
	elyvisions/cave3
	elyvisions/dark
	elyvisions/hot
	elyvisions/rainbow
	elyvisions/sh
	elyvisions/skyast
	elyvisions/skyhsky
	elyvisions/skype
	elyvisions/sp2
	elyvisions/sp3
	elyvisions/tron
	skies/alt
	skies/bloodynight
	skies/downworld
	skies/frost
	skies/river-c
	skies/scottstorm
	skies/snowalps
	skies/sp
	skies/sp2
	skies/toxic
	skies/utopia
	yello/sky/bleed
	yello/sky/energy
	yello/sky/fdshajklnljkdiog
	yello/sky/royale
	james/grilledcheese
	vz/apocalypse
	vz/apocalypse_ocean
	vz/classic
	vz/classic_land
	vz/clear
	vz/clear_ocean
	vz/dawn
	vz/dusk
	vz/empty_space
	vz/gray
	vz/moody
	vz/netherworld
	vz/sinister
	vz/sinister_land
	vz/sinister_ocean
	vz/sunshine
	vz/techno
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  Create New Entity:

nodebug [
	defvar NEL_ColorPreset -1 0 9
	defvar NEL_Bright       0 1 1

	defvar NEL_Radius 0 128 512
	defvar NEL_ColorR 0 255 255
	defvar NEL_ColorG 0 255 255
	defvar NEL_ColorB 0 255 255
]

newgui "newent_light" [
	guiscale .7
	guialign 0 [
		guititle (concatword "^f2/newent light ^f2" $NEL_Radius " ^f3" $NEL_ColorR " ^f0" $NEL_ColorG " ^f1" $NEL_ColorB )
	]
	guibar
	guifreerow  9  1 [ guitext "radius: "
			 ] 64 -2 [ guislider NEL_Radius 0 512
	]
	guistrut 1
	guilist [// H
		guilist [// V
			guistrut 9 1
			guialign 1 [guitext "color: "]
			guistrut 1
			guialign 1 [guicolor (+ (* (+ (* $NEL_ColorR 256) $NEL_ColorG) 256) $NEL_ColorB); guistrut 1]
		]
		guilist [// V
			guistrut 64 1
			guislider NEL_ColorR 0 255 [NEL_ColorPreset -1]
			guislider NEL_ColorG 0 255 [NEL_ColorPreset -1]
			guislider NEL_ColorB 0 255 [NEL_ColorPreset -1]
		]
	]
	guistrut 0.25
	guilist [// H
		guilist [// V
			guistrut 9 1
		]
		guilist [// V
			guistrut 64 1
			guialign 0 [// H
				guiradio "^f7white "  NEL_ColorPreset 0 [NEL_LightSet 255 255 255]
				guiradio "^f3red "    NEL_ColorPreset 1 [NEL_LightSet 255 192 192]
				guiradio "^f6orange " NEL_ColorPreset 2 [NEL_LightSet 255 224 192]
				guiradio "^f2yellow " NEL_ColorPreset 3 [NEL_LightSet 255 255 192]
				guiradio "^f0green "  NEL_ColorPreset 4 [NEL_LightSet 192 255 192]
				guiradio "^f8cyan "   NEL_ColorPreset 5 [NEL_LightSet 192 255 255]
				guiradio "^f1blue "   NEL_ColorPreset 6 [NEL_LightSet 192 192 255]
				guiradio "^f5violet " NEL_ColorPreset 7 [NEL_LightSet 255 192 255]
			]
			guistrut 0.25
			guialign 0 [// H
				guicheckbox "bright" NEL_Bright 1 0 [if [>= $NEL_ColorPreset 0] [NEL_LightScale]]
			]
		]
	]
	guistrut 1
	guialign 0 [
		guibutton "^f2create" [newent light $NEL_Radius $NEL_ColorR $NEL_ColorG $NEL_ColorB]
	]
] "newent light"


NEL_Reset = [
	NEL_ColorPreset 0
	NEL_Bright   1
	NEL_Radius 128
	NEL_ColorR 255
	NEL_ColorG 255
	NEL_ColorB 255
]

NEL_LightSet = [
	NEL_ColorR $arg1
	NEL_ColorG $arg2
	NEL_ColorB $arg3
	if (= $NEL_Bright 0) NEL_LightScale
]

NEL_LightScale = [
	if (= $NEL_Bright 0) [
		NEL_ColorR (div $NEL_ColorR 2)
		NEL_ColorG (div $NEL_ColorG 2)
		NEL_ColorB (div $NEL_ColorB 2)
	][
		NEL_ColorR (min 255 (* $NEL_ColorR 2))
		NEL_ColorG (min 255 (* $NEL_ColorG 2))
		NEL_ColorB (min 255 (* $NEL_ColorB 2))
	]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
nodebug [
	defvar TelePort_Tag 0 0 10000
	defvar TeleDest_Tag 0 0 10000

	TelePortList = ""
	TeleDestList = ""
]

newgui "newent_teleport" [
	guiscale .7

	guilist [// H
		guilist [//V
			guistrut 32 1
			guialign 0 [// H
				guititle (concatword "^f2/newent teleport " $TelePort_Tag "^t")
				guistayopen [
					guibutton "" [TelePort_Tag (max (+ $TelePort_Tag -1)     0)] "val_dec"
					guibutton "" [TelePort_Tag (min (+ $TelePort_Tag  1) 10000)] "val_inc"
				]
			]
			guistrut 0.5
			guialign 0 [
				guibutton "create" [newent teleport $TelePort_Tag]
			]
		]
		guibar
		guilist [//V
			guistrut 32 1
			guialign 0 [// H
				guititle (concatword "^f2/newent teledest " $TeleDest_Tag "^t")
				guistayopen [
					guibutton "" [TeleDest_Tag (max (+ $TeleDest_Tag -1)     0)] "val_dec"
					guibutton "" [TeleDest_Tag (min (+ $TeleDest_Tag  1) 10000)] "val_inc"
				]
			]
			guistrut 0.5
			guialign 0 [
				guibutton "create" [newent teledest $TeleDest_Tag]
			]
			guistrut 0.25
		]
	]
	guibar
	guilist [// H
		guilist [//V
			guistrut 32 1
			guititle "teleports"
			guialign 0 [// H
				guistrut 1.5 1
				guistayopen [
					looplist iPort $TelePortList [
						guibutton (concatword " " $iPort " ") [cancelsel; entfind teleport @iPort; gotosel] 0
					]
				]
			]
		]
		guibar
		guilist [//V
			guistrut 32 1
			guititle "destinations"
			guialign 0 [// H
				guistrut 1.5 1
				guistayopen [
					looplist iDest $TeleDestList [
						guibutton (concatword " " $iDest " ") [cancelsel; entfind teledest * @iDest; gotosel] 0
					]
				]
			]
		]
	]
] "newent teleport" [GenTeleLists]

GenTeleLists = [
	TelePortList = ""
	TeleDestList = ""
	cancelsel
	entfind *
	entloop [
		cond [=s $enttype "teleport"][ TelePortList = (concat $TelePortList (entattr 0))
		]    [=s $enttype "teledest"][ TeleDestList = (concat $TeleDestList (entattr 1))
		]
	]
	cancelsel

	TelePortList = (sortlist $TelePortList iA iB [naturalsort $iA $iB])
	if (> (listlen $TelePortList) 1) [TelePortList = (listpurgedups $TelePortList)]

	TeleDestList = (sortlist $TeleDestList iA iB [naturalsort $iA $iB])
	if (> (listlen $TeleDestList) 1) [TeleDestList = (listpurgedups $TeleDestList)]

	//  Find first unused:
	iPort = 0
	while [<= $iPort 255] [
		if [= (listfind TelePortList $iPort) -1] [
			TelePort_Tag $iPort
			iPort = 256 // Break/ExitLoop
		][
			iPort = (+ $iPort 1)
		]
	]
	iDest = 0
	while [<= $iDest 255] [
		if [= (listfind TeleDestList $iDest) -1] [
			TeleDest_Tag $iDest
			iDest = 256 // Break/ExitLoop
		][
			iDest = (+ $iDest 1)
		]
	]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
newgui "newent_trigger" [
	guibutton "invisible"   [BTmm = -1; showgui "newent_trigger2"]
	guibutton "a carrot"    [BTmm = 23; showgui "newent_trigger2"]
	guibutton "switch #1"   [BTmm = 24; showgui "newent_trigger2"]
	guibutton "switch #2"   [BTmm = 25; showgui "newent_trigger2"]
	guibutton "door #1"     [BTmm = 26; showgui "newent_trigger2"]
	guibutton "door #2"     [BTmm = 27; showgui "newent_trigger2"]
	guibutton "door #3"     [BTmm = 28; showgui "newent_trigger2"]
]

newgui "newent_trigger2" [
	guibutton "animation loop"                      [BTtt =  0; showgui "newent_trigger3"]
	guibutton "trigger once (popback)"              [BTtt =  1; showgui "newent_trigger3"]
	guibutton "trigger once (popback & rumble)"     [BTtt =  2; showgui "newent_trigger3"]
	guibutton "trigger once"                        [BTtt =  3; showgui "newent_trigger3"]
	guibutton "trigger once (rumble)"               [BTtt =  4; showgui "newent_trigger3"]
	guibutton "trigger multiple (popback)"          [BTtt =  5; showgui "newent_trigger3"]
	guibutton "trigger multiple (popback & rumble)" [BTtt =  6; showgui "newent_trigger3"]
	guibutton "trigger multiple"                    [BTtt =  7; showgui "newent_trigger3"]
	guibutton "trigger multiple (rumble)"           [BTtt =  8; showgui "newent_trigger3"]
	guibutton "door (open once)"                    [BTtt =  9; showgui "newent_trigger3"]
	guibutton "door (auto close)"                   [BTtt = 10; showgui "newent_trigger3"]
	guibutton "door (locked)"                       [BTtt = 11; showgui "newent_trigger3"]
	guibutton "vanishing trigger"                   [BTtt = 12; showgui "newent_trigger3"]
	guibutton "vanishing trigger (rumble)"          [BTtt = 13; showgui "newent_trigger3"]
	guibutton "End of Level Trigger"                [BTtt = 29; showgui "newent_trigger3"]
]

build_trigger = [newent mapmodel $BTmm $BTtt $BTti]
newgui "newent_trigger3" [
	loop i 9 [
		_tjt = (concat tag (concatword # $i))
		_tjc = (concat BTti "=" $i ";" "build_trigger")
		guibutton $_tjt $_tjc
	]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//TODO 0 "menus_editing.cfg -- Rework all this editing stuff."


newgui "materials" [
	guibutton "air"                        [editmat air]
	guibutton "water"                      [editmat water]
	guibutton "lava"                       [editmat lava]
	guibutton "clip"                       [editmat clip]
	guibutton "glass"                      [editmat glass]
	guibutton "noclip"                     [editmat noclip]
	guibutton "gameclip"                   [editmat gameclip]
	guibutton "death"                      [editmat death]
	guibutton "alpha"                      [editmat alpha]

	guicheckbox "show material volumes"    [showmat]

	//guibutton "waterlod very high (3)"  [waterlod 3]
	//guibutton "waterlod high      (2)"  [waterlod 2]
	//guibutton "waterlod default   (1)"  [waterlod 1]
	//guibutton "waterlod low       (0)"  [waterlod 0]

	//guibutton "watersubdiv very fine (0)"  [watersubdiv 0]
	//guibutton "watersubdiv fine      (1)"  [watersubdiv 1]
	//guibutton "watersubdiv default   (2)"  [watersubdiv 2]
	//guibutton "watersubdiv coarse    (3)"  [watersubdiv 3]

	//guibutton "water waves on"  [waterwaves 1]
	//guibutton "water waves off" [waterwaves 0]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
entupdate = [ entset $entguitype $entguiattr0 $entguiattr1 $entguiattr2 $entguiattr3 $entguiattr4 ]

initentgui = [
	entguitype = (enttype)
	@(loopconcat i 5 [
		result [ entguiattr@i = (entattr @i) ]
		]
	)
]

genentattributes = [
	entattributes = (loopconcat i (listlen $arg2) [
		entattribname = (at $arg2 $i)
		entattriblimits = (at $arg3 (* 2 $i))
		entattriblimits2 = (at $arg3 (+ 1 (* 2 $i)))
		if (=s (at $entattriblimits 0) $entattriblimits) [
			result [
				guitext @entattribname
				guislider entguiattr@i @entattriblimits @entattriblimits2 entupdate
			]
		][
			result [
				guitext @entattribname
				guinameslider entguiattr@i [@@entattriblimits] [@@entattriblimits2] entupdate
			]
		]
	])
]

quickeditmenu = [
	guitext "Quick Commands:"
	guibar
	guifield  EDT_SaveMap_Name 10 [ savemap $EDT_SaveMap_Name ]
	guibutton "quick light"       [calclight -1]
	guibutton "optimize map"      [remip]
	guibutton "new entity"        [newent shells]
	guibar
	guibutton newmap
	guibar
	guibutton help "showgui editing"
]

matmenu = [
	guibutton "air"                        [editmat air]
	guibutton "water"                      [editmat water]
	guibutton "lava"                       [editmat lava]
	guibutton "clip"                       [editmat clip]
	guibutton "glass"                      [editmat glass]
	guibutton "noclip"                     [editmat noclip]
	guibutton "gameclip"                   [editmat gameclip]
	guibutton "death"                      [editmat death]
	guibutton "alpha"                      [editmat alpha]
	guicheckbox "show material volumes"    [showmat]
]

brushmenu = [
	guititle diamonds
	guilist [
		guiimage "packages/icons/brush_1c.png"   [brush_0]
		guiimage "packages/icons/brush_21c.png"  [brush_1]
		guiimage "packages/icons/brush_421c.png" [brush_2]
	]
	guititle squares
	guilist [
		guiimage "packages/icons/brush_3s.png"   [brush_3]
		guiimage "packages/icons/brush_5s.png"   [brush_4]
		guiimage "packages/icons/brush_7s.png"   [brush_5]
	]
	guititle smooth
	guilist [
		guiimage "packages/icons/brush_3s.png"   [brush_6]
		guiimage "packages/icons/brush_5s.png"   [brush_7]
		guiimage "packages/icons/brush_7s.png"   [brush_8]
	]
]

newentgui = [
	genentattributes $arg1 $arg2 $arg3
	newgui $arg1 [
		guitext $entguitype
		guibar
		@entattributes
		guitab type
		guilistsplit n 2 $EntityTypes [
			guibutton $n [ entset @n ]
		]
		guitab misc
		@quickeditmenu
	] "" [initentgui]
]

looplist i $EntityTypes [
	newentgui $i "" ""
]

newgui "materials" [
	@matmenu
	guitab misc
	@quickeditmenu
]

newgui "brushes" [
	@brushmenu
	guitab misc
	@quickeditmenu
]

newgui "quickedit" [
	@quickeditmenu
	guitab materials
	@matmenu
]

newentgui light "radius red green blue" "1 400 0 255 0 255 0 255"
newentgui spotlight "radius" "0 200"
newentgui playerstart "direction" "0 360"
newentgui teleport "tag" "0 20"
newentgui teledest "direction tag" "0 360 0 20"
newentgui monster "direction type" "0 360 0 7"
newentgui mapmodel "direction model" "0 360 0 372"
newentgui envmap "radius" "0 512"
newentgui jumppad "Z Y X" "-128 128 -128 127 -128 127"
newentgui sound "type radius size" "0 20 0 500 0 500"
newentgui particles "type" "0 13"

showentgui = [ contexteditgui ] // legacy bind
contexteditgui = [
	if $hmapedit [showgui "brushes"] [
		if (enthavesel) [
			showgui (enttype)
		][
			showgui (? (havesel) materials quickedit)
		]
	]
]

newgui "seltexinfo" [
	guitext (concatword "Slot: " (getseltex))
	guilist [
		loop iSubSlot 5 [
			_texname = (gettexname (getseltex) $iSubSlot)
			_texname = (substr $_texname (+ (strstr $_texname ">") 1)) // chop off any leading commands
			guiimage (concatword "packages/" $_texname) "" 1 1
		]
	]
	loop iSubSlot 5 [
		_texname = (gettexname (getseltex) $iSubSlot)
		if (=s $_texname "") [] [guitext $_texname]
	]
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  vColor Editor:
nodebug [
	defvar  VC_Red -1 100000  100000
	defvar  VC_Grn -1 100000  100000
	defvar  VC_Blu -1 100000  100000

	defvar  VC_Hue -1      0  360000
	defvar  VC_Sat -1      0  100000
	defvar  VC_Vib -1 100000  100000

	defsvar VC_RGB "1.0 1.0 1.0"
	defsvar VC_HSV "1.0 1.0 1.0"

	defvar  VC_LiveSet 0 0 1 [if (&& $VC_LiveSet (ingamemp)) [VC_LiveSet 0]]
]

newgui "vcolor" [
	guiposition 0 1
	if (|| (! $editing) (! (ingame))) [cleargui 1] [
		guistayopen [
			guilist [// H
				guilist [// V
					guistrut 66.5 1
					guialign 0 [// H
						guitext "^f2vcolor: "
						if (! $getseltex) [
							guitext "^f3~^f7, ^f0~^f7, ^f1~" //  None or subdivided-cube selected.
						][
							guitext (concatword "^f3" (at (getvcolor $getseltex) 0) "  ^f0" (at (getvcolor $getseltex) 1) "  ^f1" (at (getvcolor $getseltex) 2))
						]
						guistrut 4
						guibutton "^f2GET" [VC_Get]
					]
				]
				guilist [// V
					guistrut 68 1
					guialign 0 [// H
						guibutton "^f8SET" [VC_Set 1]
						guistrut 2.5
						if (= (ingamemp) 0) [guicheckbox "LiveSet" VC_LiveSet 1 0]
					]
				]
			]
			guialign 0 [// H
				guilist [// V
					guistrut 2.5 1
					guistrut 0.45; guialign 1 [guitext "^f3R "]
					guistrut 0.5 ; guialign 1 [guitext "^f0G "]
					guistrut 0.5 ; guialign 1 [guitext "^f1B "]
				]
				guilist [// V
					guistrut 64 1
					guistrut 0.5; guislider VC_Red 0 100000 [VC_UpdateHSV; VC_Set]
					guistrut 0.5; guislider VC_Grn 0 100000 [VC_UpdateHSV; VC_Set]
					guistrut 0.5; guislider VC_Blu 0 100000 [VC_UpdateHSV; VC_Set]
				]
				guilist [// V
					guistrut 4 1
					guistrut 0.45
					cond [< $VC_Hue  25000][TextColor = 3
					]    [< $VC_Hue  45000][TextColor = 6
					]    [< $VC_Hue  75000][TextColor = 2
					]    [< $VC_Hue 150000][TextColor = 0
					]    [< $VC_Hue 200000][TextColor = 8
					]    [< $VC_Hue 270000][TextColor = 1
					]    [< $VC_Hue 330000][TextColor = 5
					][TextColor = 3]
					guialign 1 [guitext (concatword "^f" $TextColor "H ")] // H
					guistrut 0.5
					TextColor = (? (< $VC_Sat 66666) (? (< $VC_Sat 33333) 4 9) 7)
					guialign 1 [guitext (concatword "^f" $TextColor "S ")] // H
					guistrut 0.5
					TextColor = (? (< $VC_Vib 66666) (? (< $VC_Vib 33333) 4 9) 7)
					guialign 1 [guitext (concatword "^f" $TextColor "V ")] // H
				]
				guilist [// V
					guistrut 64 1
					guistrut 0.5
					guislider VC_Hue 0 360000 [VC_UpdateRGB; VC_Set]
					guistrut 0.5
					guislider VC_Sat 0 100000 [VC_UpdateRGB; VC_Set]
					guistrut 0.5
					guislider VC_Vib 0 100000 [VC_UpdateRGB; VC_Set]
				]
			]
		]
	]
] 0

//#############################################################################################################################################
VC_Get = [
	VC_Red = (*f (at (getvcolor $getseltex) 0) 100000)
	VC_Grn = (*f (at (getvcolor $getseltex) 1) 100000)
	VC_Blu = (*f (at (getvcolor $getseltex) 2) 100000)
	VC_UpdateHSV
]
VC_Set = [
	if (|| (> $numargs 0) [&& $VC_LiveSet (= (ingamemp) 0)]) [
		vcolor (*f $VC_Red 0.00001) (*f $VC_Grn 0.00001) (*f $VC_Blu 0.00001)
	]
]

//#############################################################################################################################################
VC_UpdateHSV = [
	VC_HSV = (color_rgbtohsv (concat (*f $VC_Red 0.00001) (*f $VC_Grn 0.00001) (*f $VC_Blu 0.00001)))
	VC_Hue = (*f (at $VC_HSV 0) 100000)
	VC_Sat = (*f (at $VC_HSV 1) 100000)
	VC_Vib = (*f (at $VC_HSV 2) 100000)
]
VC_UpdateRGB = [
	VC_RGB = (color_hsvtorgb (concat (*f $VC_Hue 0.00001) (*f $VC_Sat 0.00001) (*f $VC_Vib 0.00001)))
	VC_Red = (*f (at $VC_RGB 0) 100000)
	VC_Grn = (*f (at $VC_RGB 1) 100000)
	VC_Blu = (*f (at $VC_RGB 2) 100000)
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  vShaderParam Editor:
nodebug [
	defvar VSP_DoEnvScale       0 0 1
	defvar VSP_DoGlowColor      0 0 1
	defvar VSP_DoPulseGlowColor 0 0 1
	defvar VSP_DoPulseGlowSpeed 0 0 1
	defvar VSP_DoPulseSpeed     0 0 1
	defvar VSP_DoParallaxScale  0 0 1
	defvar VSP_DoSpecScale      0 0 1

	defvar VSP_EnvScaleR       0 100 1000 // 0 to 10
	defvar VSP_EnvScaleG       0 100 1000 // 0 to 10    Reflection Scalar
	defvar VSP_EnvScaleB       0 100 1000 // 0 to 10

	defvar VSP_GlowColorR      0 100 1000 // 0 to 10
	defvar VSP_GlowColorG      0 100 1000 // 0 to 10    GlowColor Multiplier (Pulse from)
	defvar VSP_GlowColorB      0 100 1000 // 0 to 10
	defvar VSP_PulseGlowColorR 0 100 1000 // 0 to 10
	defvar VSP_PulseGlowColorG 0 100 1000 // 0 to 10    GlowColor Multiplier (Pulse to)
	defvar VSP_PulseGlowColorB 0 100 1000 // 0 to 10
	defvar VSP_PulseGlowSpeed  0 100 2000 // 0 to 20    Pulse Frequency (Hz)

	defvar VSP_PulseSpeed      0 100 2000 // 0 to 20    Pulse Frequency (Hz)

	defvar VSP_ParallaxScaleA -100  6 100 // -1 to 1    Parallax Scaling...
	defvar VSP_ParallaxScaleB -100 -3 100 // -1 to 1

	defvar VSP_SpecScaleR      0 100 1000 // 0 to 10
	defvar VSP_SpecScaleG      0 100 1000 // 0 to 10    Specularity Multiplier
	defvar VSP_SpecScaleB      0 100 1000 // 0 to 10

	defvar VSP_LiveSet 0 0 1 [if (&& $VSP_LiveSet (ingamemp)) [VSP_LiveSet 0]]
]

newgui "vshaderparam" [
	guiscale .5
	guiposition 0 1
	guistayopen [guinoautotab [
		guilist [
			guistrut 0.25
			guilist [
				guistrut 64 1
				//=============================================================================================================================
				guialign 0 [
					guistrut 2
					guibutton "RESET" [VSP_Reset; VSP_Set 1]
					guistrut 10
					guibutton "^f2GET ALL" [VSP_GetAll]
					guistrut 10
					guibutton "^f8SET" [VSP_Set 1]
					guistrut 3
					if (= (ingamemp) 0) [
						//guicheckbox (concatword (? $VSP_LiveSet (? (mod (div $getmillis 500) 2) "^f1" "^f8") "^f7") "LiveSet") VSP_LiveSet 1 0
						guicheckbox "LiveSet" VSP_LiveSet 1 0
					]
				]
				//=============================================================================================================================
				//guistrut 0.5
				guilist [
					guicheckbox "envscale" VSP_DoEnvScale 1 0 [VSP_Set]
					guispring
					if (>= (indexof (getvshaderparamnames $getseltex) "envscale") 0) [
						Got = (getvshaderparam $getseltex "envscale"      )
						guitext (concatword "^f3" (at $Got 0) "  ^f0" (at $Got 1) "  ^f1" (at $Got 2) )
						guistrut 2
						guibutton "^f2GET" [VSP_Get_EnvScale]
					][
						guitext "^f4~  ~  ~"
						guistrut 2
						guibutton "^f4GET" [sleep 1]
					]
				]
				guilist [guilist [guistrut 2.5 1; guitext "^f8R"]; guilist [guistrut 64 1; guislider VSP_EnvScaleR  0 1000 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8G"]; guilist [guistrut 64 1; guislider VSP_EnvScaleG  0 1000 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8B"]; guilist [guistrut 64 1; guislider VSP_EnvScaleB  0 1000 [VSP_Set] ]]
				//=============================================================================================================================
				guistrut 1
				guilist [
					guicheckbox "specscale" VSP_DoSpecScale 1 0 [VSP_Set]
					guispring
					if (>= (indexof (getvshaderparamnames $getseltex) "specscale") 0) [
						Got = (getvshaderparam $getseltex "specscale")
						guitext (concatword "^f3" (at $Got 0) "  ^f0" (at $Got 1) "  ^f1" (at $Got 2) )
						guistrut 2
						guibutton "^f2GET" [VSP_Get_SpecScale]
					][
						guitext "^f4~  ~  ~"
						guistrut 2
						guibutton "^f4GET" [sleep 1]
					]
				]
				guilist [guilist [guistrut 2.5 1; guitext "^f8R"]; guilist [guistrut 64 1; guislider VSP_SpecScaleR 0 1000 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8G"]; guilist [guistrut 64 1; guislider VSP_SpecScaleG 0 1000 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8B"]; guilist [guistrut 64 1; guislider VSP_SpecScaleB 0 1000 [VSP_Set] ]]
				//=============================================================================================================================
				guistrut 1
				guilist [
					guicheckbox "parallaxscale" VSP_DoParallaxScale 1 0 [VSP_Set]
					guispring
					if (>= (indexof (getvshaderparamnames $getseltex) "parallaxscale") 0) [
						Got = (getvshaderparam $getseltex "parallaxscale")
						guitext (concatword "^f2" (at $Got 0) "  " (at $Got 1) )
						guistrut 2
						guibutton "^f2GET" [VSP_Get_ParallaxScale]
					][
						guitext "^f4~  ~"
						guistrut 2
						guibutton "^f4GET" [sleep 1]
					]
				]
				guilist [guilist [guistrut 2.5 1; guitext "^f8A"]; guilist [guistrut 64 1; guislider VSP_ParallaxScaleA -100 100 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8B"]; guilist [guistrut 64 1; guislider VSP_ParallaxScaleB -100 100 [VSP_Set] ]]
				//=============================================================================================================================
			]
			guibar
			guistrut 0.25
			guilist [
				guistrut 64 1
				//=============================================================================================================================
				guilist [
					guicheckbox "glowcolor" VSP_DoGlowColor 1 0 [VSP_Set]
					guispring
					if (>= (indexof (getvshaderparamnames $getseltex) "glowcolor") 0) [
						Got = (getvshaderparam $getseltex "glowcolor")
						guitext (concatword "^f3" (at $Got 0) "  ^f0" (at $Got 1) "  ^f1" (at $Got 2) )
						guistrut 2
						guibutton "^f2GET" [VSP_Get_GlowColor]
					][
						guitext "^f4~  ~  ~"
						guistrut 2
						guibutton "^f4GET" [sleep 1]
					]
				]
				guilist [guilist [guistrut 2.5 1; guitext "^f8R"];  guilist [guistrut 64 1; guislider VSP_GlowColorR 0 1000 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8G"];  guilist [guistrut 64 1; guislider VSP_GlowColorG 0 1000 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8B"];  guilist [guistrut 64 1; guislider VSP_GlowColorB 0 1000 [VSP_Set] ]]
				//=============================================================================================================================
				guistrut 0.5
				guilist [
					guicheckbox "pulseglowcolor" VSP_DoPulseGlowColor 1 0 [VSP_Set]
					guispring
					if (>= (indexof (getvshaderparamnames $getseltex) "pulseglowcolor") 0) [
						Got = (getvshaderparam $getseltex "pulseglowcolor")
						guitext (concatword "^f3" (at $Got 0) "  ^f0" (at $Got 1) "  ^f1" (at $Got 2) )
						guistrut 2
						guibutton "^f2GET" [VSP_Get_PulseGlowColor]
					][
						guitext "^f4~  ~  ~"
						guistrut 2
						guibutton "^f4GET" [sleep 1]
					]
				]
				guilist [guilist [guistrut 2.5 1; guitext "^f8R"];  guilist [guistrut 64 1; guislider VSP_PulseGlowColorR 0 1000 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8G"];  guilist [guistrut 64 1; guislider VSP_PulseGlowColorG 0 1000 [VSP_Set] ]]
				guilist [guilist [guistrut 2.5 1; guitext "^f8B"];  guilist [guistrut 64 1; guislider VSP_PulseGlowColorB 0 1000 [VSP_Set] ]]
				//=============================================================================================================================
				guistrut 0.5
				guilist [
					guicheckbox "pulseglowspeed" VSP_DoPulseGlowSpeed 1 0 [VSP_Set]
					guispring
					if (>= (indexof (getvshaderparamnames $getseltex) "pulseglowspeed") 0) [
						guitext (concat "^f2" (at (getvshaderparam $getseltex "pulseglowspeed") 0) )
						guistrut 2
						guibutton "^f2GET" [VSP_Get_PulseGlowSpeed]
					][
						guitext "^f4~"
						guistrut 2
						guibutton "^f4GET" [sleep 1]
					]
				]
				guilist [guilist [guistrut 2.5 1; guitext "^f8Hz"]; guilist [guistrut 64 1; guislider VSP_PulseGlowSpeed 1 2000 [VSP_Set] ]]
				//=============================================================================================================================
				guistrut 1
				guilist [
					guicheckbox "pulsespeed" VSP_DoPulseSpeed 1 0 [VSP_Set]
					guispring
					if (>= (indexof (getvshaderparamnames $getseltex) "pulsespeed") 0) [
						guitext (concat "^f2" (at (getvshaderparam $getseltex "pulsespeed") 0) )
						guistrut 2
						guibutton "^f2GET" [VSP_Get_PulseSpeed]
					][
						guitext "^f4~"
						guistrut 2
						guibutton "^f4GET" [sleep 1]
					]
				]
				guilist [guilist [guistrut 2.5 1; guitext "^f8Hz"]; guilist [guistrut 64 1; guislider VSP_PulseSpeed 1 2000 [VSP_Set] ]]
				//=============================================================================================================================
			]
		]
	]]
] 0 []

//#############################################################################################################################################
VSP_Reset = [
	VSP_DoEnvScale        0
	VSP_DoGlowColor       0
	VSP_DoPulseGlowColor  0
	VSP_DoPulseGlowSpeed  0
	VSP_DoPulseSpeed      0
	VSP_DoParallaxScale   0
	VSP_DoSpecScale       0

	VSP_EnvScaleR       100
	VSP_EnvScaleG       100
	VSP_EnvScaleB       100
	VSP_GlowColorR      100
	VSP_GlowColorG      100
	VSP_GlowColorB      100
	VSP_PulseGlowColorR 100
	VSP_PulseGlowColorG 100
	VSP_PulseGlowColorB 100
	VSP_PulseGlowSpeed  100
	VSP_PulseSpeed      100
	VSP_ParallaxScaleA    6
	VSP_ParallaxScaleB   -3
	VSP_SpecScaleR      100
	VSP_SpecScaleG      100
	VSP_SpecScaleB      100
]

//#############################################################################################################################################
VSP_GetAll = [
	VSP_DoEnvScale       0
	VSP_DoGlowColor      0
	VSP_DoPulseGlowColor 0
	VSP_DoPulseGlowSpeed 0
	VSP_DoPulseSpeed     0
	VSP_DoParallaxScale  0
	VSP_DoSpecScale      0

	VSP_Get_EnvScale
	VSP_Get_GlowColor
	VSP_Get_PulseGlowColor
	VSP_Get_PulseGlowSpeed
	VSP_Get_PulseSpeed
	VSP_Get_ParallaxScale
	VSP_Get_SpecScale
]

//#############################################################################################################################################
VSP_Get_EnvScale = [
	if (>= (indexof (getvshaderparamnames $getseltex) "envscale") 0) [
		Got = (getvshaderparam $getseltex "envscale")
		VSP_EnvScaleR (round (*f (at $Got 0) 100))
		VSP_EnvScaleG (round (*f (at $Got 1) 100))
		VSP_EnvScaleB (round (*f (at $Got 2) 100))
		VSP_DoEnvScale 1
	]
]
VSP_Get_GlowColor = [
	if (>= (indexof (getvshaderparamnames $getseltex) "glowcolor") 0) [
		Got = (getvshaderparam $getseltex "glowcolor")
		VSP_GlowColorR (round (*f (at $Got 0) 100))
		VSP_GlowColorG (round (*f (at $Got 1) 100))
		VSP_GlowColorB (round (*f (at $Got 2) 100))
		VSP_DoGlowColor 1
	]
]
VSP_Get_PulseGlowColor = [
	if (>= (indexof (getvshaderparamnames $getseltex) "pulseglowcolor") 0) [
		Got = (getvshaderparam $getseltex "pulseglowcolor")
		VSP_PulseGlowColorR (round (*f (at $Got 0) 100))
		VSP_PulseGlowColorG (round (*f (at $Got 1) 100))
		VSP_PulseGlowColorB (round (*f (at $Got 2) 100))
		VSP_DoPulseGlowColor 1
	]
]
VSP_Get_PulseGlowSpeed = [
	if (>= (indexof (getvshaderparamnames $getseltex) "pulseglowspeed") 0) [
		Got = (getvshaderparam $getseltex "pulseglowspeed")
		VSP_PulseGlowSpeed (round (*f (at $Got 0) 100))
		VSP_DoPulseGlowSpeed 1
	]
]
VSP_Get_PulseSpeed = [
	if (>= (indexof (getvshaderparamnames $getseltex) "pulsespeed") 0) [
		Got = (getvshaderparam $getseltex "pulsespeed")
		VSP_PulseSpeed (round (*f (at $Got 0) 100))
		VSP_DoPulseSpeed 1
	]
]
VSP_Get_ParallaxScale = [
	if (>= (indexof (getvshaderparamnames $getseltex) "parallaxscale") 0) [
		Got = (getvshaderparam $getseltex "parallaxscale")
		VSP_ParallaxScaleA (round (*f (at $Got 0) 100))
		VSP_ParallaxScaleB (round (*f (at $Got 1) 100))
		VSP_DoParallaxScale 1
	]
]
VSP_Get_SpecScale = [
	if (>= (indexof (getvshaderparamnames $getseltex) "specscale") 0) [
		Got = (getvshaderparam $getseltex "specscale")
		VSP_SpecScaleR (round (*f (at $Got 0) 100))
		VSP_SpecScaleG (round (*f (at $Got 1) 100))
		VSP_SpecScaleB (round (*f (at $Got 2) 100))
		VSP_DoSpecScale 1
	]
]

//#############################################################################################################################################
VSP_Set = [
	if (|| (> $numargs 0) [&& $VSP_LiveSet (= (ingamemp) 0)]) [
		vshaderparam ""
		if $VSP_DoEnvScale       [vdelta [vshaderparam "envscale"       (*f $VSP_EnvScaleR       0.01) (*f $VSP_EnvScaleG       0.01) (*f $VSP_EnvScaleB       0.01) ]]
		if $VSP_DoGlowColor      [vdelta [vshaderparam "glowcolor"      (*f $VSP_GlowColorR      0.01) (*f $VSP_GlowColorG      0.01) (*f $VSP_GlowColorB      0.01) ]]
		if $VSP_DoPulseGlowColor [vdelta [vshaderparam "pulseglowcolor" (*f $VSP_PulseGlowColorR 0.01) (*f $VSP_PulseGlowColorG 0.01) (*f $VSP_PulseGlowColorB 0.01) ]]
		if $VSP_DoPulseGlowSpeed [vdelta [vshaderparam "pulseglowspeed" (*f $VSP_PulseGlowSpeed  0.01)                                                               ]]
		if $VSP_DoPulseSpeed     [vdelta [vshaderparam "pulsespeed"     (*f $VSP_PulseSpeed      0.01)                                                               ]]
		if $VSP_DoParallaxScale  [vdelta [vshaderparam "parallaxscale"  (*f $VSP_ParallaxScaleA  0.01) (*f $VSP_ParallaxScaleB  0.01)                                ]]
		if $VSP_DoSpecScale      [vdelta [vshaderparam "specscale"      (*f $VSP_SpecScaleR      0.01) (*f $VSP_SpecScaleG      0.01) (*f $VSP_SpecScaleB      0.01) ]]
	]
]

